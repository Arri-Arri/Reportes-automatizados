---
output:
  word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



##  GARANTÍA Y DEFENSA DE LOS DERECHOS HUMANOS CENTRADA EN LA ATENCIÓN A LAS VÍCTIMAS
###

```{r servicios, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}


rm(list=ls())

dir_trab <- getwd()
setwd(dir_trab)
# install.packages("ggforce")
library(tidyverse)
library(dplyr)
library(dummies)
library(summarytools)
library(magrittr)
library(knitr)
library(kableExtra)
library(readr)
library(tidyr)
library(forcats)
library(flextable)
library(officer)
library(RSQLite)
library(sqldf)
library(nycflights13)
library(RODBC)
library(readr)
library(ggplot2)
library(scales)
library(ggrepel)
#install.packages("ggforce")
library(ggforce)



#install.packages("ggforce")
library(ggforce)




Fecha_Ini <- '2021/01/01'
Fecha_Fin <- '2022/01/01'

Conexion <- odbcConnect("data_source", uid="ciadh", pwd="sBp60000")

#Expedientes
query2 <- paste0("declare @Fecha_Ini char(10)
declare @Fecha_Fin char(10)
set  @Fecha_Ini = '",Fecha_Ini,"'
set  @Fecha_Fin = '",Fecha_Fin,"'

		SELECT DISTINCT 
							  dbo.Expediente.Id_expediente, dbo.Expediente.Id_gestion AS IdGstnExpe, dbo.Expediente.Fecha_creacion,
							  year(dbo.Expediente.Fecha_creacion) as Anio,DATENAME (mm,dbo.Expediente.Fecha_creacion)as Mes,
							   dbo.Expediente.Nombre AS Expediente, 
							  dbo.Expediente.Numero_expediente, dbo.Expediente.Id_adscripcion, dbo.Adscripcion.Nombre AS Nombre_adscripcion, dbo.Expediente.Id_calificacion, 
							  dbo.Cat_expediente_calificacion.Calificacion, dbo.Expediente.Fecha_calificacion, dbo.Expediente.Id_estatus, dbo.Cat_expediente_estatus.Estatus, 
							  dbo.Expediente.Id_tipo_conclusion, dbo.Cat_expediente_tipo_conclusion.Tipo_conclusion, dbo.Expediente.Fecha_conclusion, 
							  RTRIM(Persona_3.Nombre) + ' ' + RTRIM(Persona_3.Apellido_paterno) + ' ' + RTRIM(Persona_3.Apellido_materno) AS Empleado_investigador,
							  CASE WHEN dbo.Expediente.Nombre LIKE '%/P%' THEN '/P' ELSE '' END AS 'Penitenciarias'
		--Into T_ar2r_Otros
		FROM         dbo.T_ar2r_Expedientillo_Remisiones RIGHT OUTER JOIN
							  dbo.Expediente ON dbo.T_ar2r_Expedientillo_Remisiones.Id_queja = dbo.Expediente.Id_gestion LEFT OUTER JOIN
							  dbo.Expediente_investigador ON dbo.Expediente.Id_expediente = dbo.Expediente_investigador.Id_expediente LEFT OUTER JOIN
							  dbo.Empleado INNER JOIN
							  dbo.Persona AS Persona_3 ON dbo.Empleado.Id_persona = Persona_3.Id_persona ON 
							  dbo.Expediente_investigador.Id_empleado = dbo.Empleado.Id_empleado LEFT OUTER JOIN
							  dbo.Cat_expediente_tipo_conclusion ON 
							  dbo.Expediente.Id_tipo_conclusion = dbo.Cat_expediente_tipo_conclusion.Id_tipo_conclusion LEFT OUTER JOIN
							  dbo.Cat_expediente_calificacion ON dbo.Expediente.Id_calificacion = dbo.Cat_expediente_calificacion.Id_calificacion LEFT OUTER JOIN
							  dbo.Cat_expediente_estatus ON dbo.Expediente.Id_estatus = dbo.Cat_expediente_estatus.Id_estatus LEFT OUTER JOIN
							  dbo.Adscripcion ON dbo.Expediente.Id_adscripcion = dbo.Adscripcion.Id_adscripcion
		WHERE     (dbo.Expediente.Fecha_creacion >= @Fecha_Ini) AND (dbo.Expediente.Fecha_creacion < @Fecha_Fin) AND 
							  (dbo.T_ar2r_Expedientillo_Remisiones.Id_queja IS NULL) and  not (dbo.Expediente.Id_estatus =3)
")


#Personas en Expedientes
query3 <- paste0("declare @Fecha_Ini char(10)
declare @Fecha_Fin char(10)
set  @Fecha_Ini = '",Fecha_Ini,"'
set  @Fecha_Fin = '",Fecha_Fin,"'

SELECT DISTINCT 
                      dbo.Expediente.Id_expediente, dbo.Expediente.Id_gestion AS IdGstnExpe, dbo.Expediente.Fecha_creacion, YEAR(dbo.Expediente.Fecha_creacion) AS anio, 
                      DATENAME(month, dbo.Expediente.Fecha_creacion) AS mes, dbo.Expediente.Nombre AS Expediente, dbo.Expediente.Numero_expediente, 
                      dbo.Expediente.Id_adscripcion, dbo.Adscripcion.Nombre AS Nombre_adscripcion, dbo.Expediente.Id_calificacion, dbo.Cat_expediente_calificacion.Calificacion, 
                      dbo.Expediente.Fecha_calificacion, dbo.Expediente.Id_estatus, dbo.Cat_expediente_estatus.Estatus, dbo.Expediente.Id_tipo_conclusion, 
                      dbo.Cat_expediente_tipo_conclusion.Tipo_conclusion, dbo.Expediente.Fecha_conclusion, RTRIM(Persona_3.Nombre) + ' ' + RTRIM(Persona_3.Apellido_paterno) 
                      + ' ' + RTRIM(Persona_3.Apellido_materno) AS Empleado_investigador, RTRIM(Persona_2.Nombre) + ' ' + RTRIM(Persona_2.Apellido_paterno) 
                      + ' ' + RTRIM(Persona_2.Apellido_materno) AS Empleado_calificador, dbo.V_Personas_Grupos_Unificados_r2.Id_persona, 
                      dbo.V_Personas_Grupos_Unificados_r2.Persona, dbo.V_Personas_Grupos_Unificados_r2.Id_caracter_persona, dbo.V_Personas_Grupos_Unificados_r2.Caracter, 
                      dbo.V_Personas_Grupos_Unificados_r2.Edad, dbo.V_Personas_Grupos_Unificados_r2.Sexo, dbo.V_Personas_Grupos_Unificados_r2.Nacionalidad, 
                      CASE WHEN dbo.Expediente.Nombre LIKE '%/P%' THEN '/P' ELSE '' END AS 'Penitenciarias'
--Into T_ar2r_Otros
FROM         dbo.Cat_expediente_estatus RIGHT OUTER JOIN
                      dbo.Cat_expediente_calificacion RIGHT OUTER JOIN
                      dbo.Expediente INNER JOIN
                      dbo.V_Personas_Grupos_Unificados_r2 ON dbo.Expediente.Id_gestion = dbo.V_Personas_Grupos_Unificados_r2.Id_gestion LEFT OUTER JOIN
                      dbo.Cat_expediente_tipo_conclusion ON dbo.Expediente.Id_tipo_conclusion = dbo.Cat_expediente_tipo_conclusion.Id_tipo_conclusion LEFT OUTER JOIN
                      dbo.Expediente_investigador ON dbo.Expediente.Id_expediente = dbo.Expediente_investigador.Id_expediente ON 
                      dbo.Cat_expediente_calificacion.Id_calificacion = dbo.Expediente.Id_calificacion ON 
                      dbo.Cat_expediente_estatus.Id_estatus = dbo.Expediente.Id_estatus LEFT OUTER JOIN
                      dbo.Adscripcion ON dbo.Expediente.Id_adscripcion = dbo.Adscripcion.Id_adscripcion LEFT OUTER JOIN
                      dbo.Empleado AS Empleado_2 INNER JOIN
                      dbo.Persona AS Persona_2 ON Empleado_2.Id_persona = Persona_2.Id_persona RIGHT OUTER JOIN
                      dbo.Expediente_calificador ON Empleado_2.Id_empleado = dbo.Expediente_calificador.Id_empleado ON 
                      dbo.Expediente.Id_expediente = dbo.Expediente_calificador.Id_expediente LEFT OUTER JOIN
                      dbo.Empleado INNER JOIN
                      dbo.Persona AS Persona_3 ON dbo.Empleado.Id_persona = Persona_3.Id_persona ON 
                      dbo.Expediente_investigador.Id_empleado = dbo.Empleado.Id_empleado
WHERE     (dbo.Expediente.Fecha_creacion >= @Fecha_Ini) AND (dbo.Expediente.Fecha_creacion < @Fecha_Fin) AND (NOT (dbo.Expediente.Id_estatus = 3))")

#Autoridades
query4 <- paste0("declare @Fecha_Ini char(10)
declare @Fecha_Fin char(10)
set  @Fecha_Ini = '",Fecha_Ini,"'
set  @Fecha_Fin = '",Fecha_Fin,"'

SELECT DISTINCT 
	v_menciones_derecho.Id_gestion
      ,v_menciones_derecho.Fecha_creacion
      ,v_menciones_derecho.Anio
      ,v_menciones_derecho.Mes
      ,v_menciones_derecho.Id_expediente
      ,v_menciones_derecho.Expediente
      ,v_menciones_derecho.Numero_expediente
      ,v_menciones_derecho.Id_adscripcion
      ,v_menciones_derecho.Adscripcion
      ,v_menciones_derecho.Id_calificacion
      ,v_menciones_derecho.Calificacion
      ,v_menciones_derecho.Id_estatus
      ,v_menciones_derecho.Estatus
      ,v_menciones_derecho.Id_tipo_conclusion
      ,v_menciones_derecho.Tipo_conclusion
      ,v_menciones_derecho.Fecha_conclusion
      ,v_menciones_derecho.Id_Investigador
      ,v_menciones_derecho.Investigador
      ,v_menciones_derecho.Penitenciarias
      ,v_menciones_derecho.Fecha_actualizacion
      ,v_menciones_derecho.Id_Poder
      ,v_menciones_derecho.Poder
      ,v_menciones_derecho.Id_Ambito
      ,v_menciones_derecho.Ambito
      ,v_menciones_derecho.Id_Unidad
      ,v_menciones_derecho.Unidad
      ,v_menciones_derecho.Id_Generico
      ,v_menciones_derecho.Organismo_Generico
      ,v_menciones_derecho.Id_Organismo
      ,v_menciones_derecho.Organismo
      ,v_menciones_derecho.Id_Grupo
      ,v_menciones_derecho.Nombre_Grupo
  FROM siigesi_cdhdf.dbo.v_menciones_derecho	
WHERE dbo.v_menciones_derecho.Fecha_creacion >= @Fecha_Ini AND dbo.v_menciones_derecho.Fecha_creacion < @Fecha_Fin")

# Temáticas en expedientes
query5 <- paste0("declare @Fecha_Ini char(10)
declare @Fecha_Fin char(10)
set  @Fecha_Ini = '",Fecha_Ini,"'
set  @Fecha_Fin = '",Fecha_Fin,"'

		SELECT DISTINCT 
							  dbo.Expediente.Id_expediente, dbo.Expediente.Id_gestion AS IdGstnExpe, dbo.Expediente.Fecha_creacion,
							  year(dbo.Expediente.Fecha_creacion) as Anio,DATENAME (mm,dbo.Expediente.Fecha_creacion)as Mes,
							   dbo.Expediente.Nombre AS Expediente, 
							  dbo.Expediente.Numero_expediente, dbo.Expediente.Id_adscripcion, dbo.Adscripcion.Nombre AS Nombre_adscripcion, dbo.Expediente.Id_calificacion, 
							  dbo.Cat_expediente_calificacion.Calificacion, dbo.Expediente.Fecha_calificacion, dbo.Expediente.Id_estatus, dbo.Cat_expediente_estatus.Estatus, 
							  dbo.Expediente.Id_tipo_conclusion, dbo.Cat_expediente_tipo_conclusion.Tipo_conclusion, dbo.Expediente.Fecha_conclusion, 
							  RTRIM(Persona_3.Nombre) + ' ' + RTRIM(Persona_3.Apellido_paterno) + ' ' + RTRIM(Persona_3.Apellido_materno) AS Empleado_investigador,
							  CASE WHEN dbo.Expediente.Nombre LIKE '%/P%' THEN '/P' ELSE '' END AS 'Penitenciarias'
							  ,Gestion_tematica_servicio.Id_tematica_servicio, Cat_tematica_servicio.Tematica_servicio
		FROM         dbo.T_ar2r_Expedientillo_Remisiones RIGHT OUTER JOIN
							  dbo.Expediente ON dbo.T_ar2r_Expedientillo_Remisiones.Id_queja = dbo.Expediente.Id_gestion LEFT OUTER JOIN
							  dbo.Expediente_investigador ON dbo.Expediente.Id_expediente = dbo.Expediente_investigador.Id_expediente LEFT OUTER JOIN
							  dbo.Empleado INNER JOIN
							  dbo.Persona AS Persona_3 ON dbo.Empleado.Id_persona = Persona_3.Id_persona ON 
							  dbo.Expediente_investigador.Id_empleado = dbo.Empleado.Id_empleado LEFT OUTER JOIN
							  dbo.Cat_expediente_tipo_conclusion ON 
							  dbo.Expediente.Id_tipo_conclusion = dbo.Cat_expediente_tipo_conclusion.Id_tipo_conclusion LEFT OUTER JOIN
							  dbo.Cat_expediente_calificacion ON dbo.Expediente.Id_calificacion = dbo.Cat_expediente_calificacion.Id_calificacion LEFT OUTER JOIN
							  dbo.Cat_expediente_estatus ON dbo.Expediente.Id_estatus = dbo.Cat_expediente_estatus.Id_estatus LEFT OUTER JOIN
							  dbo.Adscripcion ON dbo.Expediente.Id_adscripcion = dbo.Adscripcion.Id_adscripcion
							  LEFT OUTER JOIN Gestion_tematica_servicio 
								ON Gestion_tematica_servicio.Id_gestion = Expediente.Id_gestion
							LEFT OUTER JOIN Cat_tematica_servicio
								ON Cat_tematica_servicio.Id_tematica_servicio = Gestion_tematica_servicio.Id_tematica_servicio
		WHERE     (dbo.Expediente.Fecha_creacion >= @Fecha_Ini) AND (dbo.Expediente.Fecha_creacion < @Fecha_Fin) AND 
							  (dbo.T_ar2r_Expedientillo_Remisiones.Id_queja IS NULL) and  not (dbo.Expediente.Id_estatus =3)
							  and Cat_tematica_servicio.Id_tematica_servicio is not null
")

# Menciones a derecho
query6 <- paste0("declare @Fecha_Ini char(10)
declare @Fecha_Fin char(10)
set  @Fecha_Ini = '",Fecha_Ini,"'
set  @Fecha_Fin = '",Fecha_Fin,"'

SELECT DISTINCT 
	v_menciones_derecho.Id_gestion
      ,v_menciones_derecho.Fecha_creacion
      ,v_menciones_derecho.Anio
      ,v_menciones_derecho.Mes
      ,v_menciones_derecho.Id_expediente
      ,v_menciones_derecho.Expediente
      ,v_menciones_derecho.Numero_expediente
      ,v_menciones_derecho.Id_adscripcion
      ,v_menciones_derecho.Adscripcion
      ,v_menciones_derecho.Id_calificacion
      ,v_menciones_derecho.Calificacion
      ,v_menciones_derecho.Id_estatus
      ,v_menciones_derecho.Estatus
      ,v_menciones_derecho.Id_tipo_conclusion
      ,v_menciones_derecho.Tipo_conclusion
      ,v_menciones_derecho.Fecha_conclusion
      ,v_menciones_derecho.Id_Investigador
      ,v_menciones_derecho.Investigador
      ,v_menciones_derecho.Penitenciarias
      ,v_menciones_derecho.Fecha_actualizacion
      ,v_menciones_derecho.Id_Poder
      ,v_menciones_derecho.Poder
      ,v_menciones_derecho.Id_Ambito
      ,v_menciones_derecho.Ambito
      ,v_menciones_derecho.Id_Unidad
      ,v_menciones_derecho.Unidad
      ,v_menciones_derecho.Id_Generico
      ,v_menciones_derecho.Organismo_Generico
      ,v_menciones_derecho.Id_Organismo
      ,v_menciones_derecho.Organismo
      ,v_menciones_derecho.Id_Grupo
      ,v_menciones_derecho.Nombre_Grupo
      ,v_menciones_derecho.Id_Derecho
      ,v_menciones_derecho.Derecho
      ,v_menciones_derecho.Id_Denuncia
      ,v_menciones_derecho.Denuncia
      ,v_menciones_derecho.IdStatsDenuncia
      ,v_menciones_derecho.IdConcluDenun
      ,v_menciones_derecho.ConclusionDenun
  FROM siigesi_cdhdf.dbo.v_menciones_derecho
WHERE dbo.v_menciones_derecho.Fecha_creacion >= @Fecha_Ini AND dbo.v_menciones_derecho.Fecha_creacion < @Fecha_Fin")

# Lugar de los hechos en expedientes
query7 <- paste0("declare @Fecha_Ini char(10)
declare @Fecha_Fin char(10)
set  @Fecha_Ini = '",Fecha_Ini,"'
set  @Fecha_Fin = '",Fecha_Fin,"'

		SELECT DISTINCT 
							  dbo.Expediente.Id_expediente, dbo.Expediente.Id_gestion AS IdGstnExpe, dbo.Expediente.Fecha_creacion,
							  year(dbo.Expediente.Fecha_creacion) as Anio,DATENAME (mm,dbo.Expediente.Fecha_creacion)as Mes,
							   dbo.Expediente.Nombre AS Expediente, 
							  dbo.Expediente.Numero_expediente, dbo.Expediente.Id_adscripcion, dbo.Adscripcion.Nombre AS Nombre_adscripcion, dbo.Expediente.Id_calificacion, 
							  dbo.Cat_expediente_calificacion.Calificacion, dbo.Expediente.Fecha_calificacion, dbo.Expediente.Id_estatus, dbo.Cat_expediente_estatus.Estatus, 
							  dbo.Expediente.Id_tipo_conclusion, dbo.Cat_expediente_tipo_conclusion.Tipo_conclusion, dbo.Expediente.Fecha_conclusion, 
							  RTRIM(Persona_3.Nombre) + ' ' + RTRIM(Persona_3.Apellido_paterno) + ' ' + RTRIM(Persona_3.Apellido_materno) AS Empleado_investigador,
							  CASE WHEN dbo.Expediente.Nombre LIKE '%/P%' THEN '/P' ELSE '' END AS 'Penitenciarias',
							  IIF(dbo.Domicilio.Municipio LIKE 'Venuscarra%','Venustiano Carranza',dbo.Domicilio.Municipio) AS Municipio
		--Into T_ar2r_Otros
		FROM         dbo.T_ar2r_Expedientillo_Remisiones RIGHT OUTER JOIN
							  dbo.Expediente ON dbo.T_ar2r_Expedientillo_Remisiones.Id_queja = dbo.Expediente.Id_gestion LEFT OUTER JOIN
							  dbo.Expediente_investigador ON dbo.Expediente.Id_expediente = dbo.Expediente_investigador.Id_expediente LEFT OUTER JOIN
							  dbo.Empleado INNER JOIN
							  dbo.Persona AS Persona_3 ON dbo.Empleado.Id_persona = Persona_3.Id_persona ON 
							  dbo.Expediente_investigador.Id_empleado = dbo.Empleado.Id_empleado LEFT OUTER JOIN
							  dbo.Cat_expediente_tipo_conclusion ON 
							  dbo.Expediente.Id_tipo_conclusion = dbo.Cat_expediente_tipo_conclusion.Id_tipo_conclusion LEFT OUTER JOIN
							  dbo.Cat_expediente_calificacion ON dbo.Expediente.Id_calificacion = dbo.Cat_expediente_calificacion.Id_calificacion LEFT OUTER JOIN
							  dbo.Cat_expediente_estatus ON dbo.Expediente.Id_estatus = dbo.Cat_expediente_estatus.Id_estatus LEFT OUTER JOIN
							  dbo.Adscripcion ON dbo.Expediente.Id_adscripcion = dbo.Adscripcion.Id_adscripcion							  
							  INNER JOIN	dbo.Vinculo_gestion
								ON		dbo.Expediente.Id_gestion = dbo.Vinculo_gestion.Id_gestion_padre
	INNER  JOIN	dbo.Lugar_donde_ocurrieron_hechos
		ON		dbo.Lugar_donde_ocurrieron_hechos.Id_gestion = dbo.Vinculo_gestion.Id_gestion_hijo
	LEFT OUTER JOIN dbo.Domicilio
		ON		dbo.Domicilio.Id_domicilio = dbo.Lugar_donde_ocurrieron_hechos.Id_domicilio
		WHERE     (dbo.Expediente.Fecha_creacion >= @Fecha_Ini) AND (dbo.Expediente.Fecha_creacion < @Fecha_Fin) AND 
							  (dbo.T_ar2r_Expedientillo_Remisiones.Id_queja IS NULL) and  not (dbo.Expediente.Id_estatus =3)
							  AND dbo.Vinculo_gestion.Id_tipo_vinculo = 4")

#Servicios
query_Servicios <- paste0("declare @Fecha_Ini char(10)
declare @Fecha_Fin char(10)
set  @Fecha_Ini = '",Fecha_Ini,"'
set  @Fecha_Fin = '",Fecha_Fin,"'

SELECT DISTINCT 
             TOP (100) PERCENT dbo.Gestion.Id_gestion, dbo.Servicio.Id_servicio, dbo.Gestion.Id_tipo_gestion, dbo.Cat_tipo_gestion.Tipo_gestion, dbo.Gestion.Titulo, dbo.Gestion.Fecha_creacion, dbo.Empleado.Id_empleado, RTRIM(dbo.Persona.Nombre) 
             + ' ' + RTRIM(dbo.Persona.Apellido_paterno) + ' ' + RTRIM(dbo.Persona.Apellido_materno) AS Empleado, dbo.Gestion.Id_status_gestion, dbo.Cat_status_gestion.Status_gestion, dbo.Gestion.Id_investigacion, dbo.Cat_tipo_investigacion.Investigacion, 
             dbo.Gestion.Id_unidad, dbo.Cat_unidad.Nombre_unidad, dbo.Gestion.Fecha_conclusion, dbo.Cat_via_entrada.Via_entrada, dbo.Servicio.Id_cat_servicio, dbo.Cat_servicio.Servicio, dbo.Cat_super_tipo_servicio.Super_tipo, dbo.Servicio_subservicio.Id_subservicio, 
             dbo.Cat_subservicio.Subservicio, dbo.Gestion.Id_adscripcion
FROM   dbo.T_Empleados_NO_r2 RIGHT OUTER JOIN
             dbo.Gestion ON dbo.T_Empleados_NO_r2.Id_empleado = dbo.Gestion.Id_empleado LEFT OUTER JOIN
             dbo.Cat_tipo_investigacion ON dbo.Gestion.Id_investigacion = dbo.Cat_tipo_investigacion.Id_investigacion LEFT OUTER JOIN
             dbo.Cat_status_gestion ON dbo.Gestion.Id_status_gestion = dbo.Cat_status_gestion.Id_status_gestion LEFT OUTER JOIN
             dbo.Empleado LEFT OUTER JOIN
             dbo.Persona ON dbo.Empleado.Id_persona = dbo.Persona.Id_persona ON dbo.Gestion.Id_empleado = dbo.Empleado.Id_empleado AND dbo.Gestion.Id_empleado = dbo.Empleado.Id_empleado LEFT OUTER JOIN
             dbo.Cat_tipo_gestion ON dbo.Gestion.Id_tipo_gestion = dbo.Cat_tipo_gestion.Id_tipo_gestion LEFT OUTER JOIN
             dbo.Cat_unidad ON dbo.Gestion.Id_unidad = dbo.Cat_unidad.Id_unidad LEFT OUTER JOIN
             dbo.Cat_subservicio RIGHT OUTER JOIN
             dbo.Cat_servicio LEFT OUTER JOIN
             dbo.Cat_super_tipo_servicio ON dbo.Cat_servicio.Id_super_tipo = dbo.Cat_super_tipo_servicio.Id_super_tipo RIGHT OUTER JOIN
             dbo.Servicio ON dbo.Cat_servicio.Id_cat_servicio = dbo.Servicio.Id_cat_servicio LEFT OUTER JOIN
             dbo.Servicio_subservicio ON dbo.Servicio.Id_servicio = dbo.Servicio_subservicio.Id_servicio ON dbo.Cat_subservicio.Id_subservicio = dbo.Servicio_subservicio.Id_subservicio ON dbo.Gestion.Id_gestion = dbo.Servicio.Id_gestion LEFT OUTER JOIN
             dbo.Cat_via_entrada RIGHT OUTER JOIN
             dbo.Gestion_via_entrada ON dbo.Cat_via_entrada.Id_via_entrada = dbo.Gestion_via_entrada.Id_via_entrada ON dbo.Gestion.Id_gestion = dbo.Gestion_via_entrada.Id_gestion
WHERE (dbo.Gestion.Fecha_creacion >= @Fecha_Ini) AND (dbo.Gestion.Fecha_creacion < @Fecha_Fin) 
		AND (dbo.Gestion.Id_tipo_gestion = 2) 
		AND (NOT (dbo.Gestion.Id_status_gestion = 4)) 
		AND (dbo.Gestion.Id_adscripcion = 'DGQYO')")

# Personas en servicios
query_Servicios_SPC <- paste0("declare @Fecha_Ini char(10)
declare @Fecha_Fin char(10)
set  @Fecha_Ini = '",Fecha_Ini,"'
set  @Fecha_Fin = '",Fecha_Fin,"'

SELECT DISTINCT 
             TOP (100) PERCENT dbo.Gestion.Id_gestion, dbo.Servicio.Id_servicio, dbo.Gestion.Id_tipo_gestion, dbo.Cat_tipo_gestion.Tipo_gestion, dbo.Gestion.Titulo, dbo.Gestion.Fecha_creacion, dbo.Empleado.Id_empleado, RTRIM(dbo.Persona.Nombre) 
             + ' ' + RTRIM(dbo.Persona.Apellido_paterno) + ' ' + RTRIM(dbo.Persona.Apellido_materno) AS Empleado, dbo.Gestion.Id_status_gestion, dbo.Cat_status_gestion.Status_gestion, dbo.Gestion.Id_investigacion, dbo.Cat_tipo_investigacion.Investigacion, 
             dbo.Gestion.Id_unidad, dbo.Cat_unidad.Nombre_unidad, dbo.Gestion.Fecha_conclusion, dbo.Cat_via_entrada.Via_entrada, dbo.Servicio.Id_cat_servicio, dbo.Cat_servicio.Servicio, dbo.Cat_super_tipo_servicio.Super_tipo, dbo.Servicio_subservicio.Id_subservicio, 
             dbo.Cat_subservicio.Subservicio, dbo.Gestion.Id_adscripcion, dbo.V_Personas_Grupos_Unificados_r2.Id_persona, dbo.V_Personas_Grupos_Unificados_r2.Persona, dbo.V_Personas_Grupos_Unificados_r2.Id_sexo, dbo.V_Personas_Grupos_Unificados_r2.Sexo, 
             dbo.V_Personas_Grupos_Unificados_r2.Edad, dbo.V_Personas_Grupos_Unificados_r2.Id_pais, 
             dbo.V_Personas_Grupos_Unificados_r2.Nacionalidad, dbo.V_Personas_Grupos_Unificados_r2.Id_caracter_persona, dbo.V_Personas_Grupos_Unificados_r2.Caracter, dbo.V_Personas_Grupos_Unificados_r2.Origen, 
             dbo.V_Personas_Grupos_Unificados_r2.Id_datos_estadisticos
--Into T_ar2r_Otros
FROM   dbo.V_Personas_Grupos_Unificados_r2 RIGHT OUTER JOIN
             dbo.Gestion ON dbo.V_Personas_Grupos_Unificados_r2.Id_gestion = dbo.Gestion.Id_gestion LEFT OUTER JOIN
             dbo.T_Empleados_NO_r2 ON dbo.Gestion.Id_empleado = dbo.T_Empleados_NO_r2.Id_empleado LEFT OUTER JOIN
             dbo.Cat_tipo_investigacion ON dbo.Gestion.Id_investigacion = dbo.Cat_tipo_investigacion.Id_investigacion LEFT OUTER JOIN
             dbo.Cat_status_gestion ON dbo.Gestion.Id_status_gestion = dbo.Cat_status_gestion.Id_status_gestion LEFT OUTER JOIN
             dbo.Empleado LEFT OUTER JOIN
             dbo.Persona ON dbo.Empleado.Id_persona = dbo.Persona.Id_persona ON dbo.Gestion.Id_empleado = dbo.Empleado.Id_empleado AND dbo.Gestion.Id_empleado = dbo.Empleado.Id_empleado LEFT OUTER JOIN
             dbo.Cat_tipo_gestion ON dbo.Gestion.Id_tipo_gestion = dbo.Cat_tipo_gestion.Id_tipo_gestion LEFT OUTER JOIN
             dbo.Cat_unidad ON dbo.Gestion.Id_unidad = dbo.Cat_unidad.Id_unidad LEFT OUTER JOIN
             dbo.Cat_subservicio RIGHT OUTER JOIN
             dbo.Cat_servicio LEFT OUTER JOIN
             dbo.Cat_super_tipo_servicio ON dbo.Cat_servicio.Id_super_tipo = dbo.Cat_super_tipo_servicio.Id_super_tipo RIGHT OUTER JOIN
             dbo.Servicio ON dbo.Cat_servicio.Id_cat_servicio = dbo.Servicio.Id_cat_servicio LEFT OUTER JOIN
             dbo.Servicio_subservicio ON dbo.Servicio.Id_servicio = dbo.Servicio_subservicio.Id_servicio ON dbo.Cat_subservicio.Id_subservicio = dbo.Servicio_subservicio.Id_subservicio ON dbo.Gestion.Id_gestion = dbo.Servicio.Id_gestion LEFT OUTER JOIN
             dbo.Cat_via_entrada RIGHT OUTER JOIN
             dbo.Gestion_via_entrada ON dbo.Cat_via_entrada.Id_via_entrada = dbo.Gestion_via_entrada.Id_via_entrada ON dbo.Gestion.Id_gestion = dbo.Gestion_via_entrada.Id_gestion
WHERE (dbo.Gestion.Fecha_creacion >= @Fecha_Ini) AND (dbo.Gestion.Fecha_creacion < @Fecha_Fin) AND (dbo.Gestion.Id_tipo_gestion = 2) AND (NOT (dbo.Gestion.Id_status_gestion = 4)) AND (dbo.T_Empleados_NO_r2.Id_empleado IS NULL) AND 
             (dbo.Gestion.Id_adscripcion = 'DGQYO')		 			 
ORDER BY dbo.Gestion.Id_gestion")

#Perfil socio demografico
query_perfil <- paste0("declare @Fecha_Ini char(10)
declare @Fecha_Fin char(10)
set  @Fecha_Ini = '",Fecha_Ini,"'
set  @Fecha_Fin = '",Fecha_Fin,"'

SELECT DISTINCT 
             TOP (100) PERCENT dbo.Gestion.Id_gestion, dbo.Servicio.Id_servicio, dbo.Gestion.Id_tipo_gestion, dbo.Cat_tipo_gestion.Tipo_gestion, dbo.Gestion.Titulo, dbo.Gestion.Fecha_creacion, dbo.Empleado.Id_empleado, RTRIM(dbo.Persona.Nombre) 
             + ' ' + RTRIM(dbo.Persona.Apellido_paterno) + ' ' + RTRIM(dbo.Persona.Apellido_materno) AS Empleado, dbo.Gestion.Id_status_gestion, dbo.Cat_status_gestion.Status_gestion, dbo.Gestion.Id_investigacion, dbo.Cat_tipo_investigacion.Investigacion, 
             dbo.Gestion.Id_unidad, dbo.Cat_unidad.Nombre_unidad, dbo.Gestion.Fecha_conclusion, dbo.Cat_via_entrada.Via_entrada, dbo.Servicio.Id_cat_servicio, dbo.Cat_servicio.Servicio, dbo.Cat_super_tipo_servicio.Super_tipo, dbo.Servicio_subservicio.Id_subservicio, 
             dbo.Cat_subservicio.Subservicio, dbo.Gestion.Id_adscripcion, dbo.V_Personas_Grupos_Unificados_r2.Id_persona, dbo.V_Personas_Grupos_Unificados_r2.Persona, dbo.V_Personas_Grupos_Unificados_r2.Id_sexo, dbo.V_Personas_Grupos_Unificados_r2.Sexo, 
             dbo.V_Personas_Grupos_Unificados_r2.Edad, dbo.V_Personas_Grupos_Unificados_r2.Id_pais, 
             dbo.V_Personas_Grupos_Unificados_r2.Nacionalidad, dbo.V_Personas_Grupos_Unificados_r2.Id_caracter_persona, dbo.V_Personas_Grupos_Unificados_r2.Caracter, dbo.V_Personas_Grupos_Unificados_r2.Origen, 
             dbo.V_Personas_Grupos_Unificados_r2.Id_datos_estadisticos,
			 dbo.V_Persona_perfil_sociodemografico_r2.No_Perfiles, dbo.V_Persona_perfil_sociodemografico_r2.Id_perfil, dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil_salud, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_salud, dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil_salud_publica, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_salud_publica, dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil_sociodemografico_salud_publica_local, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_salud_publica_local, dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil_sociodemografico_salud_publica_federal, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_salud_publica_federal, dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil_sociodemografico_salud_privada, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_salud_privada, dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_salud_otro, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil_sociodemografico_servicio_medico, dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_servicio_medico, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil_sociodemografico_servicio_medico_publica, dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_servicio_medico_publica, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_servicio_medico_otro, dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil_escolaridad, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_escolaridad, dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil_laboral, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_laboral, dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil_laboral_tipo_trabajo, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_laboral_tipo_trabajo, dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil_laboral_ocupacion, 
                         dbo.V_Persona_perfil_sociodemografico_all_r2.Perfil_sociodemografico_laboral_ocupacion
--Into T_ar2r_Otros
FROM   dbo.V_Personas_Grupos_Unificados_r2 RIGHT OUTER JOIN
             dbo.Gestion ON dbo.V_Personas_Grupos_Unificados_r2.Id_gestion = dbo.Gestion.Id_gestion LEFT OUTER JOIN
             dbo.T_Empleados_NO_r2 ON dbo.Gestion.Id_empleado = dbo.T_Empleados_NO_r2.Id_empleado LEFT OUTER JOIN
             dbo.Cat_tipo_investigacion ON dbo.Gestion.Id_investigacion = dbo.Cat_tipo_investigacion.Id_investigacion LEFT OUTER JOIN
             dbo.Cat_status_gestion ON dbo.Gestion.Id_status_gestion = dbo.Cat_status_gestion.Id_status_gestion LEFT OUTER JOIN
             dbo.Empleado LEFT OUTER JOIN
             dbo.Persona ON dbo.Empleado.Id_persona = dbo.Persona.Id_persona ON dbo.Gestion.Id_empleado = dbo.Empleado.Id_empleado AND dbo.Gestion.Id_empleado = dbo.Empleado.Id_empleado LEFT OUTER JOIN
             dbo.Cat_tipo_gestion ON dbo.Gestion.Id_tipo_gestion = dbo.Cat_tipo_gestion.Id_tipo_gestion LEFT OUTER JOIN
             dbo.Cat_unidad ON dbo.Gestion.Id_unidad = dbo.Cat_unidad.Id_unidad LEFT OUTER JOIN
             dbo.Cat_subservicio RIGHT OUTER JOIN
             dbo.Cat_servicio LEFT OUTER JOIN
             dbo.Cat_super_tipo_servicio ON dbo.Cat_servicio.Id_super_tipo = dbo.Cat_super_tipo_servicio.Id_super_tipo RIGHT OUTER JOIN
             dbo.Servicio ON dbo.Cat_servicio.Id_cat_servicio = dbo.Servicio.Id_cat_servicio LEFT OUTER JOIN
             dbo.Servicio_subservicio ON dbo.Servicio.Id_servicio = dbo.Servicio_subservicio.Id_servicio ON dbo.Cat_subservicio.Id_subservicio = dbo.Servicio_subservicio.Id_subservicio ON dbo.Gestion.Id_gestion = dbo.Servicio.Id_gestion LEFT OUTER JOIN
             dbo.Cat_via_entrada RIGHT OUTER JOIN
             dbo.Gestion_via_entrada ON dbo.Cat_via_entrada.Id_via_entrada = dbo.Gestion_via_entrada.Id_via_entrada ON dbo.Gestion.Id_gestion = dbo.Gestion_via_entrada.Id_gestion
			left OUTER JOIN  dbo.V_Persona_perfil_sociodemografico_r2
				ON dbo.V_Persona_perfil_sociodemografico_r2.Id_persona = dbo.V_Personas_Grupos_Unificados_r2.Id_persona
			left JOIN dbo.V_Persona_perfil_sociodemografico_all_r2 
				ON dbo.V_Persona_perfil_sociodemografico_all_r2.Id_perfil = dbo.V_Persona_perfil_sociodemografico_r2.Id_perfil 
WHERE (dbo.Gestion.Fecha_creacion >= @Fecha_Ini) AND (dbo.Gestion.Fecha_creacion < @Fecha_Fin) AND (dbo.Gestion.Id_tipo_gestion = 2) AND (NOT (dbo.Gestion.Id_status_gestion = 4)) AND (dbo.T_Empleados_NO_r2.Id_empleado IS NULL) AND 
             (dbo.Gestion.Id_adscripcion = 'DGQYO')
ORDER BY dbo.Gestion.Id_gestion")

query_grupos <- paste0("declare @Fecha_Ini char(10)
declare @Fecha_Fin char(10)
set  @Fecha_Ini = '",Fecha_Ini,"'
set  @Fecha_Fin = '",Fecha_Fin,"'

SELECT * FROM v_servicios_grupo
WHERE (dbo.v_servicios_grupo.Fecha_creacion >= @Fecha_Ini) AND (dbo.v_servicios_grupo.Fecha_creacion < @Fecha_Fin) 
  AND dbo.v_servicios_grupo.Id_grupo_personas IS NOT NULL")

x <- sqlQuery(Conexion, 
paste0("EXEC	[dbo].[SP_MP_SinPersona] '",Fecha_Ini,"','",Fecha_Fin,"'"))
Medidas_precautorias <- sqlQuery(Conexion,  "SELECT *from dbo.T_MP_r2 WHERE Adscripcion like '%Visitaduría%'" )
write.csv(Medidas_precautorias, "Medidas_precautorias_13012022.csv", row.names = FALSE)  


Expedientes <- sqlQuery(Conexion, query2)
write.csv(Expedientes, "Expedientes_13012022.csv", row.names = FALSE)  


Expedientes_SPC <- sqlQuery(Conexion, query3)
write.csv(Expedientes_SPC, "Expedientes_SPC_13012022.csv", row.names = FALSE)  

Autoridad_gestion <- sqlQuery(Conexion, query4)
write.csv(Autoridad_gestion, "Autoridad_gestion_13012022.csv", row.names = FALSE)  


Expedientes_tematicas <- sqlQuery(Conexion, query5)
write.csv(Expedientes_tematicas, "Expedientes_tematicas_13012022.csv", row.names = FALSE)  


Derechos <- sqlQuery(Conexion, query6)
write.csv(Derechos, "Derechos_13012022.csv", row.names = FALSE)  


Expedientes_LH <- sqlQuery(Conexion, query7)
write.csv(Expedientes_LH, "Expedientes_LH_13012022.csv", row.names = FALSE)  


Servicios <- sqlQuery(Conexion, query_Servicios)
write.csv(Servicios, "Servicios_13012022.csv", row.names = FALSE)  


Servicios_Sexo <- sqlQuery(Conexion, query_Servicios_SPC)
write.csv(Servicios_Sexo, "Servicios_Sexo_13012022.csv", row.names = FALSE)  


Escolaridad_Servicios <- sqlQuery(Conexion, query_perfil)
write.csv(Escolaridad_Servicios, "Escolaridad_Servicios_13012022.csv", row.names = FALSE)  


Grupos_Servicios <- sqlQuery(Conexion, query_grupos)
write.csv(Grupos_Servicios, "Grupos_Servicios_13012022.csv", row.names = FALSE)  


odbcClose(Conexion)
```

```{r resgitros, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}

#Servicios <- read_csv("Servicios_proporcionados_DGQAI_Ene-Jun-2021.csv")   

Servicios <- Servicios %>% mutate(Super_tipo_II = Super_tipo)

Servicios$Super_tipo[Servicios$Id_cat_servicio %in% c(6,14)] <- "Servicios de Defensa y Prevención"
Servicios$Super_tipo[Servicios$Super_tipo %in% "Servicios de Defensa y Prevención"] <- "Servicios de Orientación y Prevención"
Servicios$Super_tipo[Servicios$Super_tipo %in% "Servicios de Protección"] <- "Servicios de Protección y Defensa"

Table1 <-  table(Servicios[, c("Super_tipo")], exclude = "NULL")
Servicios_totales <- addmargins(Table1, margin=1)
Servicios_totales <- data.frame(Servicios_totales)

#Expedientes <- read_csv("Expedientes_Enero_Junio_2021.csv") 
Expedientes <- filter(Expedientes, Id_calificacion %in% c(1,9))
Num_exp <- data.frame (table(Expedientes$Anio))

Graf_1 = data.frame(Table1)

#row.names(Graf_1) <- gsub("Protecci\xf3n", "o", row.names(Graf_1))

grafica1 <- ggplot(data=Graf_1, aes(x = Var1, y = Freq, fill=Var1)) + 
    geom_bar(stat="identity", width = 0.65, position=position_dodge())+
   geom_text(aes(label=formatC(Freq, big.mark = " ")), vjust=-0.25, size = 3.1)+
    #labs(title="Servicios proporcionados (DGQAI), enero-junio de 2021")+
  scale_fill_manual(values=c('darkorange2','purple4')) +
  theme_minimal(base_rect_size = 0)+
  theme(plot.title = element_text(size=11,lineheight=1,hjust=0.5,face = "bold", colour = 'black'),
        axis.title.y = element_text( size = 10),
        axis.title.x = element_text( size = 10),
        plot.background = element_rect(fill = "white",colour = "black", size = 1), 
        panel.grid.major.y = element_line(colour = "grey70"),
        panel.spacing = unit(1, "lines"))+
  scale_y_continuous(name="", labels = number_format()) + 
  scale_x_discrete(limit = c("Servicios de Orientación y Prevención", "Servicios de Protección y Defensa"),
                     labels = c("Servicios de Orientación\n y Prevención","Servicios de Protección\n y Defensa"))+
  xlab(NULL) + 
  ylab(NULL)
  
```


En materia de garantía y defensa de los derechos humanos, a través de la Dirección General de Quejas y Atención Integral (DGQAI), las cinco visitadurías generales, la Dirección Ejecutiva de Seguimiento (DES) y la Secretaría Ejecutiva (SE), la CDHCM proporcionó un total de `r paste0(Servicios_totales[3,2])` servicios a personas peticionarias y/o víctimas que se acercaron a solicitar los servicios o lo hicieron vía remota; se registraron `r paste0(Num_exp[1,2])` expedientes de queja por posibles violaciones a derechos humanos; se calificó la conclusión de 72 puntos recomendatorias y 11 recomendaciones; y se impulsaron diversas acciones de defensa con organismos nacionales e internacionales de derechos humanos, con especial énfasis en la protección de los derechos humanos en el contexto de la emergencia sanitaria.

###
### Servicios proporcionados y personas atendidas

Durante el año 2021, el país y en consecuencia esta Ciudad enfrentó uno de los más grandes desafíos sociales con la pandemia derivada de virus SARS-CoV2 (COVID-19). Por ello, a partir del 20 de marzo de 2020 entró en vigor en la Ciudad de México la primera medida preventiva con motivo de la atención a la enfermedad COVID-19  y el 24 de marzo del mismo año, la Secretaría de Salud Federal ordenó la Jornada de Sana Distancia, a través del Acuerdo por el que se establecen las medidas preventivas que se deberán implementar para la mitigación y control de los riesgos para la salud que implica la enfermedad por el virus SARS-CoV2 (COVID-19), las cuales de forma gradual se fueron modificando mediante diversos acuerdos federales y locales. Lo anterior, implicó la suspensión de actividades no esenciales en los sectores público, privado y social; que las personas en situación de riesgo evitaran la asistencia a centros de trabajo, espacios públicos y otros lugares, entre otras. 

En el marco de las medidas adoptadas por esta Comisión en el contexto de la emergencia sanitaria por COVID19 y en virtud de los Acuerdos A/002/2020, A/003/2020, A/004/2020, A/005/2020, A/008/2020, A/010/2020, A/012/2020, A/013/2020 y A/015/2020, este Organismo suspendió plazos y términos para efectos de los actos y procedimientos competencia de esta institución del 23 de marzo al 30 de junio y del 14 al 31 de diciembre del 2020. 

Es de destacarse que dicha suspensión no operó para la recepción de peticiones, atención de casos graves y/o urgente competencia de la Comisión y atención de primer contacto de incompetencias. Por ello, durante los 365 días del año, las 24 horas del día, se brindó atención, a través de personal de guardia integrado por las Áreas de Garantía y Defensa y coordinado por la Dirección General de Quejas y Atención Integral.

Durante el año 2021, la CDHCM brindó  `r paste0(Servicios_totales[3,2])` servicios.  Del total de servicios brindados, `r paste0(Servicios_totales[1,2])` fueron servicios de orientación y prevención para los casos que fueron competencia de esta institución y `r paste0(Servicios_totales[2,2])` de protección y defensa al realizar una valoración jurídica integral para determinar la existencia de una posible violación a derechos humanos cometida por alguna persona servidora pública de un órgano del Gobierno de la Ciudad de México.

```{r grafica1, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
grafica1 + theme(legend.position = "none")
```

Es importante destacar que este año se incluyeron tres nuevos servicios: servicios de observación, aportación a expediente de Mecanismo de Restitución Inmediata de Derechos (Meride) y curso de mecanismo.

Los servicios de observación, son aquellos servicios que se brindan in situ para supervisar el actuar de las autoridades, a fin de evitar posibles violaciones a derechos humanos, pues la simple presencia del personal de la Comisión funciona como un inhibidor ante este tipo de conductas.  

En cuanto a los servicios de protección y defensa, el curso de mecanismo implica dar información de la persona a cargo del Meride para su seguimiento; mientras el servicio de aportación a expediente de mecanismo, se presenta cuando la persona plantea una solicitud inicial nueva con alguna situación complementaria a un expediente de Meride que se está atendiendo. 

Los `r paste0(Servicios_totales[1,2])` servicios de orientación y prevención se registraron de la siguiente manera:


**Servicios de orientación y prevención (DGQAI) enero-diciembre 2021 ^[Antes de 2018, en los servicios de orientación y prevención no se reportaban los cursos de remisión, pues éstos consisten únicamente en brindar a las personas que acuden o se comunican a la Comisión información de algún caso que haya sido remitido a otro organismo protector de derechos humanos. Cabe destacar que, con independencia de la comunicación anterior, a todas las personas se les informa por oficio acerca de la remisión de sus planteamientos, por lo que resultó importante mostrar la atención que se brinda a las personas peticionarias que solicitaron el servicio correspondiente. Asimismo, tampoco se incluían los documentos improcedentes, pues al no tener mayores datos de contacto sólo procedía su archivo; sin embargo, a partir de 2019 se contabilizan todos esos servicios, ya que de cualquier manera representan un contacto de este organismo con las personas a fin de hacer de su conocimiento lo anterior y brindarle, en su caso, la atención correspondiente.]**


```{r Tabla1, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
##Tabla 1##

Tabla_1 <- filter(Servicios, Super_tipo %in% c("Servicios de Orientación y Prevención"))
Table1.1 <- table(Tabla_1[, c("Servicio")], exclude = "NULL")

Table2.1 <- (round(prop.table(Table1.1),3))*100
Table1.1.1 = data.frame(Table2.1)
Table1.1.1 <- Table1.1.1[order(-Table1.1.1$Freq), ]
Table1.1  = data.frame(Table1.1)
Table1.1  <- Table1.1 [order(-Table1.1$Freq), ]

Serv_Orientacion <- merge(Table1.1, Table1.1.1, by= c("Var1"), all.x=TRUE)
Serv_Orientacion <- Serv_Orientacion[order(-Serv_Orientacion$Freq.x), ]
Serv_Orientacion <- rbind(Serv_Orientacion, data.frame(Var1 = "Total", Freq.x = sum(Serv_Orientacion[,2]), Freq.y = round(sum(Serv_Orientacion[,3]),0)))


Tabla1 <-flextable(
  Serv_Orientacion,
  col_keys = names(Serv_Orientacion),
  cwidth = 0.75,
  cheight = 0.25,
  defaults = list(),
  set_flextable_defaults( 
    font.size = 8, 
    theme_fun = theme_vanilla,
    padding.bottom = 2, 
    padding.top = 2,
    padding.left = 2,
    padding.right = 2,
    background.color = "white"))

Tabla1 <- set_header_labels(Tabla1,
                             values = list(
                               Var1="Servicio",
                               Freq.x ="Total",
                               Freq.y="Porcentaje") )

Tabla1  <- font(Tabla1 ,fontname='Arial')
Tabla1  <- fontsize(Tabla1, size = 10, part = "header")
Tabla1  <- fontsize(Tabla1, size = 10, part = "body")
Tabla1  <- bold(Tabla1, bold = TRUE, part = "header")


Tabla1 <- theme_box(Tabla1)
Tabla1 <- bg(Tabla1, i = 1, bg = "mediumpurple1", part = "header")
Tabla1 <- bg(Tabla1, i = ~ Var1 == "Total", bg = "grey70", part = "body")
#Tabla1 <- hline(Tabla1, border = fp_border(width = .75, color = "purple4"), part = "body" )
#Tabla1 <- hline(Tabla1, border = fp_border(width = 1, color = "purple4"), part = "header" )
Tabla1 <- align(Tabla1, align = "center", part = "header")
Tabla1 <- align(Tabla1,j = 1 ,align = "left", part = "body")
Tabla1 <- align(Tabla1,j = c(2,3) ,align = "right", part = "body")
Tabla1 <- colformat_num(Tabla1, big.mark = " ")
Tabla1 <- bold(Tabla1, i = ~ Var1 == "Total", bold = TRUE)
Tabla1 <- autofit(Tabla1) 

Tabla1

```


Por otro lado, los `r paste0(Servicios_totales[2,2])` servicios de protección y defensa se desglosaron del siguiente modo:

**Servicios de protección y defensa (DGQAI), enero-diciembre 2021 ^[En los servicios de protección y defensa reportados en 2018 no se reportaron cursos de queja, dado que estos únicamente consisten en informar a las personas que llaman o acuden a la Comisión el número de su expediente y el nombre de la persona encargada de su caso. Cabe destacar que, con independencia de la comunicación anterior, todas las personas son informadas de tales datos mediante comunicación escrita. Sin embargo, a partir de 2019 se contabilizaron todos los servicios al representar un contacto, de cualquier manera, de este Organismo con las personas, a fin de informarle sobre el trámite de su solicitud inicial.]**


```{r Tabla2.1, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
##Tabla 2##

Tabla_2 <- filter(Servicios, Super_tipo %in% c("Servicios de Protección y Defensa"))
Table2.1 <- table(Tabla_2[, c("Servicio")], exclude = "NULL")


Table2.2 <- (round(prop.table(Table2.1),3))*100
Table2.1.1 = data.frame(Table2.2)
Table2.1.1 <- Table2.1.1[order(-Table2.1.1$Freq), ]

Table2.1  = data.frame(Table2.1)
Table2.1  <- Table2.1[order(-Table2.1$Freq), ]

Serv_Proteccion <- merge(Table2.1, Table2.1.1, by= c("Var1"), all.x=TRUE)
Serv_Proteccion <- Serv_Proteccion[order(-Serv_Proteccion$Freq.x), ]
Serv_Proteccion <- rbind(Serv_Proteccion, data.frame(Var1 = "Total", Freq.x = sum(Serv_Proteccion[,2]), Freq.y = round(sum(Serv_Proteccion[,3]),0)))

Tabla2 <-flextable(
  Serv_Proteccion,
  col_keys = names(Serv_Proteccion),
  cwidth = 0.75,
  cheight = 0.25,
  defaults = list(),
  set_flextable_defaults( 
    font.size = 8, 
    theme_fun = theme_vanilla,
    padding.bottom = 2, 
    padding.top = 2,
    padding.left = 2,
    padding.right = 2,
    background.color = "white"))

Tabla2 <- set_header_labels(Tabla2,
                             values = list(
                               Var1="Servicio",
                               Freq.x ="Total",
                               Freq.y="Porcentaje") )

Tabla2  <- font(Tabla2 ,fontname='Arial')
Tabla2  <- fontsize(Tabla2, size = 10, part = "header")
Tabla2  <- fontsize(Tabla2, size = 10, part = "body")
Tabla2  <- bold(Tabla2, bold = TRUE, part = "header")


Tabla2 <- theme_box(Tabla2)
Tabla2 <- bg(Tabla2, i = 1, bg = "mediumpurple1", part = "header")
Tabla2 <- bg(Tabla2, i = ~ Var1 == "Total", bg = "grey70", part = "body")
Tabla2 <- align(Tabla2, align = "center", part = "header")
Tabla2 <- align(Tabla2,j = 1 ,align = "left", part = "body")
Tabla2 <- align(Tabla2,j = c(2,3) ,align = "right", part = "body")
Tabla2 <- colformat_num(Tabla2, big.mark = " ")
Tabla2 <- bold(Tabla2, i = ~ Var1 == "Total", bold = TRUE)
Tabla2 <- autofit(Tabla2) 
Tabla2
```



```{r Tabla3, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
##Tabla 3##

#Servicios_Via_entrada <- read_csv("Servicios_Via_entrada_Ene-Jun-2021.csv")

Table3.1 <- table(Servicios[, c("Via_entrada")], exclude = "NULL")


Table3.2 <- (round(prop.table(Table3.1),3))*100
Table3.1.1 = data.frame(Table3.2)
Table3.1.1 <- Table3.1.1[order(-Table3.1.1$Freq), ]

Table3.1  = data.frame(Table3.1)
Table3.1  <- Table3.1[order(-Table3.1$Freq), ]

Serv_entrada <- merge(Table3.1, Table3.1.1, by= c("Var1"), all.x=TRUE)
Serv_entrada <- Serv_entrada [order(-Serv_entrada$Freq.x), ]
Serv_entrada <- rbind(Serv_entrada, data.frame(Var1 = "Total", Freq.x = sum(Serv_entrada[,2]), Freq.y = round(sum(Serv_entrada[,3]),0)))

Tabla3 <-flextable(
  Serv_entrada,
  col_keys = names(Serv_entrada),
  cwidth = 0.75,
  cheight = 0.25,
  defaults = list(),
  set_flextable_defaults( 
    font.size = 8, 
    theme_fun = theme_vanilla,
    padding.bottom = 2, 
    padding.top = 2,
    padding.left = 2,
    padding.right = 2,
    background.color = "white"))

Tabla3 <- set_header_labels(Tabla3,
                             values = list(
                               Var1="Vía entrada",
                               Freq.x ="Total",
                               Freq.y="Porcentaje") )

Tabla3  <- font(Tabla3 ,fontname='Arial')
Tabla3 <- fontsize(Tabla3, size = 10, part = "header")
Tabla3  <- fontsize(Tabla3, size = 10, part = "body")
Tabla3  <- bold(Tabla3, bold = TRUE, part = "header")


Tabla3 <- theme_box(Tabla3)
Tabla3 <- bg(Tabla3, i = 1, bg = "mediumpurple1", part = "header")
Tabla3 <- bg(Tabla3, i = ~ Var1 == "Total", bg = "grey70", part = "body")
Tabla3 <- align(Tabla3, align = "center", part = "header")
Tabla3 <- align(Tabla3,j = 1 ,align = "left", part = "body")
Tabla3 <- align(Tabla3,j = c(2,3) ,align = "right", part = "body")
Tabla3 <- colformat_num(Tabla3, big.mark = " ")
Tabla3 <- bold(Tabla3, i = ~ Var1 == "Total", bold = TRUE)
Tabla3 <- autofit(Tabla3) 
```

La atención personal representó únicamente `r paste0(Serv_entrada[2,3])` de los servicios proporcionados durante el año 2021, siendo la vía no presencial, a través de la atención telefónica, por correo electrónico o por escrito, las que se privilegiaron en este periodo marcado por el confinamiento para mitigar el contagio de la COVID-19 en la Ciudad de México.

**Servicios proporcionados según vía de entrada (Siigesi), enero-diciembre de 2021**
```{r Tabla3.1, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Tabla3
```

```{r Tabla4, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
##Tabla 4##
#Servicios_Sexo <- read_csv("Personas y colectivos agraviados en servicios proporcionados (Siigesi)-Ene-Jun-2021.csv")   

#(Servicios_Sexo$Status_gestion)

Peticionarias <- filter(Servicios_Sexo, Caracter %in% c("Peticionario", "Ambos"), Status_gestion %in% c("Concluida"))

Table4.1 <- table(Peticionarias [, c("Sexo")], exclude = "NULL")
Table4.2 <- (round(prop.table(Table4.1),3))*100

Table4.2 = data.frame(Table4.2)
Table4.1  = data.frame(Table4.1)

Sexo_peticionarias <- merge(Table4.1, Table4.2, by= c("Var1"), all.x=TRUE)
Sexo_peticionarias <- Sexo_peticionarias[order(-Sexo_peticionarias$Freq.x),]

Sexo_peticionarias <- rbind(Sexo_peticionarias, data.frame(Var1 = "Total", Freq.x = sum(Sexo_peticionarias[,2]), Freq.y = round(sum(Sexo_peticionarias[,3]),0)))

# Sexo_peticionarias1 <- data.frame(t(Sexo_peticionarias))


Tabla4 <-flextable(
  Sexo_peticionarias,
  col_keys = names(Sexo_peticionarias),
  cwidth = 0.75,
  cheight = 0.25,
  defaults = list(),
  set_flextable_defaults( 
    font.size = 8, 
    theme_fun = theme_vanilla,
    padding.bottom = 2, 
    padding.top = 2,
    padding.left = 2,
    padding.right = 2,
    background.color = "white"))

Tabla4 <- set_header_labels(Tabla4,
                                values = list(
                                Var1="Servicio",
                                Freq.x ="Total",
                                Freq.y="Porcentaje"))

Tabla4  <- font(Tabla4, fontname='Arial')
Tabla4  <- fontsize(Tabla4, size = 10, part = "header")
Tabla4  <- fontsize(Tabla4, size = 10, part = "body")
Tabla4  <- bold(Tabla4, bold = TRUE, part = "header")
 
Tabla4 <- theme_box(Tabla4)
Tabla4 <- bg(Tabla4, i = 1, bg = "mediumpurple1", part = "header")
Tabla4 <- bg(Tabla4, i = ~ Var1 == "Total", bg = "grey70", part = "body")
Tabla4 <- align(Tabla4, align = "center", part = "header")
Tabla4 <- align(Tabla4,j = 1 ,align = "left", part = "body")
Tabla4 <- align(Tabla4,j = c(2,3) ,align = "right", part = "body")
Tabla4 <- colformat_num(Tabla4, big.mark = " ")
Tabla4 <- bold(Tabla4, i = ~ Var1 == "Total", bold = TRUE)
Tabla4 <- autofit(Tabla4) 
```

Entre enero y diciembre de 2021 la CDHCM atendió un total de `r paste0(Sexo_peticionarias[5,2])` personas, siendo la mayoría mujeres (`r paste0(Sexo_peticionarias[1,2])`).

**Sexo de las personas peticionarias en servicios proporcionados (Siigesi), enero-diciembre de 2021**
```{r Tabla4.1, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Tabla4
```




```{r Tabla5, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
##Tabla 5##

#table(Servicios_Sexo$Caracter)

Agraviadas <- filter(Servicios_Sexo, Caracter %in% c("Agraviado", "Ambos"), Status_gestion %in% c("Concluida"))

Table5.1 <- table(Agraviadas [, c("Sexo")], exclude = "NULL")
Table5.2 <- (round(prop.table(Table5.1),3))*100

Table5.2 = data.frame(Table5.2)
Table5.2  = data.frame(Table5.2)

Sexo_agraviados <- merge(Table5.1, Table5.2, by= c("Var1"), all.x=TRUE)
Sexo_agraviados <- Sexo_agraviados[order(-Sexo_agraviados$Freq.x),]

Sexo_agraviados <- rbind(Sexo_agraviados, data.frame(Var1 = "Total", Freq.x = sum(Sexo_agraviados[,2]), Freq.y = round(sum(Sexo_agraviados[,3]),0)))

Tabla5 <-flextable(
  Sexo_agraviados,
  col_keys = names(Sexo_agraviados),
  cwidth = 0.75,
  cheight = 0.25,
  defaults = list(),
  set_flextable_defaults( 
    font.size = 8, 
    theme_fun = theme_vanilla,
    padding.bottom = 2, 
    padding.top = 2,
    padding.left = 2,
    padding.right = 2,
    background.color = "white"))

Tabla5 <- set_header_labels(Tabla5,
                                values = list(
                                Var1="Servicio",
                                Freq.x ="Total",
                                Freq.y="Porcentaje"))

Tabla5  <- font(Tabla5, fontname='Arial')
Tabla5  <- fontsize(Tabla5, size = 10, part = "header")
Tabla5  <- fontsize(Tabla5, size = 10, part = "body")
Tabla5  <- bold(Tabla5, bold = TRUE, part = "header")
 
Tabla5 <- theme_box(Tabla5)
Tabla5 <- bg(Tabla5, i = 1, bg = "mediumpurple1", part = "header")
Tabla5 <- bg(Tabla5, i = ~ Var1 == "Total", bg = "grey70", part = "body")
Tabla5 <- align(Tabla5, align = "center", part = "header")
Tabla5 <- align(Tabla5,j = 1 ,align = "left", part = "body")
Tabla5 <- align(Tabla5,j = c(2,3) ,align = "right", part = "body")
Tabla5 <- colformat_num(Tabla5, big.mark = " ")
Tabla5 <- bold(Tabla5, i = ~ Var1 == "Total", bold = TRUE)
Tabla5 <- autofit(Tabla5) 
```

Entre las `r paste0(formatC(Sexo_agraviados[5,2], big.mark = " "))` personas agraviadas en los servicios proporcionados destacan `r paste0(formatC(Sexo_agraviados[2,2], big.mark = " "))`  mujeres y `r paste0(formatC(Sexo_agraviados[1,2], big.mark = " "))` hombres, así como `r paste0(formatC(Sexo_agraviados[3,2], big.mark = " "))` colectivos.

**Personas y colectivos agraviados en servicios proporcionados (Siigesi),enero-diciembre de 2021**
```{r Tabla5.1, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Tabla5
```


Respecto del nivel educativo de las personas agraviadas en los servicios proporcionados, destaca que aproximadamente la mitad tiene hasta la secundaria como nivel máximo de estudios.

```{r grafica2, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
##Grafica 2##

#Escolaridad_Servicios <- read_csv("Escolaridad_servicios_proporcionados_Siigesi_Ene-Jun-2021.csv") 

Escolaridad_Servicios <-  Escolaridad_Servicios %>% 
                          mutate(Escolaridad=case_when(
                          Perfil_sociodemografico_escolaridad=="Primaria" ~ "Primaria",
                          Perfil_sociodemografico_escolaridad=="Ninguna" ~ "Ninguna",
                          Perfil_sociodemografico_escolaridad=="Preescolar" ~ "Primaria",
                          Perfil_sociodemografico_escolaridad=="Secundaria" ~ "Secundaria",
                          Perfil_sociodemografico_escolaridad=="Bachillerato" ~ "Media superior",
                          Perfil_sociodemografico_escolaridad=="Carrera tecnica o comercial" ~ "Media superior",
                          Perfil_sociodemografico_escolaridad=="Licenciatura" ~ "Superior",
                          Perfil_sociodemografico_escolaridad=="Maestria o Doctorado" ~ "Superior",
                          Perfil_sociodemografico_escolaridad=="No contesto" ~ "NULL",
                          Perfil_sociodemografico_escolaridad=="No especifico" ~ "NULL",
                          Perfil_sociodemografico_escolaridad=="NA"~ "NULL"
                          )) 
 

Escolaridad_Servicios$Escolaridad[is.na(Escolaridad_Servicios$Escolaridad)] <- "NULL"
Graf2 <- table(Escolaridad_Servicios[, c("Escolaridad")], exclude = "NULL")
Graf2 <- (round(prop.table(Graf2),3))*100
Graf2 <- data.frame(Graf2)
Graf2 <- Graf2 %>% 
                          mutate(NIVEL=case_when(
                            Var1=="Ninguna" ~ "0",
                          Var1=="Primaria" ~ "1",
                          Var1=="Secundaria" ~ "2",
                          Var1=="Media superior" ~ "3",
                          Var1=="Superior" ~ "4",
                          Var1=="NULL"~ "NULL"
                          ))
Graf2 <- Graf2[order(Graf2$NIVEL,decreasing = TRUE),]
Graf2 <- rename(Graf2, c(Escolaridad="Var1"))
Graf2 <- Graf2[,c(1,2)]
Graf2$Escolaridad <- factor(Graf2$Escolaridad, levels = c("Ninguna", "Primaria", "Secundaria", "Media superior", "Superior"))

#Posisión para las etiquetas
Graf2Pos <- Graf2 %>% 
  mutate(end = 2 * pi * cumsum(Freq)/sum(Freq),
         start = lag(end, default = 0),
         middle = 0.5 * (start + end),
         hju = ifelse(middle > pi, 1, 0),
         vju = ifelse(middle < pi/2 | middle > 3 * pi/2, 0, 1))

ggplot(Graf2Pos)+
  geom_arc_bar(aes(x0 = 0, y0 = 0, r0 = 0, r = 1,
                   start = start, end = end, fill = Escolaridad)) +
  geom_text(aes(x = 1.05 * sin(middle), y = 1.05 * cos(middle),label = paste0(Escolaridad,",\n",round(Freq,1),"%"), 
                vjust = vju, hjust = hju), size = 4, color="black",family = "Arial") +
  coord_fixed() +
  theme_void() +
  scale_x_continuous(limits = c(-2, 2),  # Adjust so labels are not cut off
                     name = "", breaks = NULL, labels = NULL) +
  scale_y_continuous(limits = c(-1.2, 1.2),    # Adjust so labels are not cut off
                     name = "", breaks = NULL, labels = NULL) + 
  scale_fill_manual(values=c("darkblue","orange","gray50","darkorange2","steelblue")) +

  theme(#legend.title = element_text(face = "bold",size = 12, family = "Arial"),
        #legend.text = element_text(size = 12, family = "Arial"),
        axis.ticks = element_blank(),
        axis.title = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none"
        )

                                 
```

En cuanto al perfil laboral reportado, seis de cada 10 personas que contestaron estar laborando estan en el sector formal. Aunque en términos generales estas proporciones son similares entre hombres y mujeres, destaca la importancia que tiene el trabajo doméstico no remunerado, pues una de cada dos mujeres que no trabaja se dedica a estas labores.

**Perfil laboral de las personas en servicios proporcionados (Siigesi), enero-diciembre de 2021**
```{r Tabla6, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
##Grafica 2##

#Escolaridad_Servicios <- read_csv("Escolaridad_servicios_proporcionados_Siigesi_Ene-Jun-2021.csv") 


Escolaridad_Servicios <-  Escolaridad_Servicios %>% 
                          mutate(Ocupacion=case_when(
                          Perfil_sociodemografico_laboral=="Trabaja"   ~ "Ocupadas",
                          Perfil_sociodemografico_laboral=="No trabaja"   ~ "Desocupadas e inactivas",  
                          Perfil_sociodemografico_laboral=="No contesto"   ~ "NULL",
                          Perfil_sociodemografico_laboral=="No especifico" ~ "NULL"),
                          Tipo_ocupacion=Perfil_sociodemografico_laboral_tipo_trabajo,
                          Aux=1)
                          
 
#Tipo_ocupacion=recode(Tipo_ocupacion, "No contesto=NULL"),
#Tipo_ocupacion=recode(Tipo_ocupacion , "No especifico=NULL


 
#table(Escolaridad_Servicios$Tipo_ocupacion)

Escolaridad_Servicios$Ocupacion[is.na(Escolaridad_Servicios$Ocupacion)] <- "NULL"

Tab6 <- ftable(Escolaridad_Servicios[, c("Ocupacion", "Tipo_ocupacion", "Id_perfil_laboral" )], exclude = "NULL")

Tab6.1 <- ftable(Escolaridad_Servicios[, c("Tipo_ocupacion", "Aux")], exclude = "NULL")



Auxxy <- merge(Tab6, Tab6.1, by.x="Tipo_ocupacion", by.y="Tipo_ocupacion", all.x = TRUE)

Auxxy1 <- filter(Auxxy, Freq.x!=0)

Auxxy2 <- Auxxy1 %>% 
          mutate(Porcentaje = (round((Freq.x / sum(Freq.x)), 3))*100)

Auxxy3 <- select(Auxxy2, c(Ocupacion, Tipo_ocupacion, Porcentaje) )
Auxxy4  <- Auxxy3[order(Auxxy3$Ocupacion, decreasing = TRUE), ]

Auxxy4.1 <- Auxxy4[Auxxy4$Ocupacion %in% 'Ocupadas',]
Auxxy4.1 <- Auxxy4.1[order(Auxxy4.1$Porcentaje, decreasing = TRUE), ]
Auxxy4.1 <- rbind(Auxxy4.1,data.frame(Ocupacion = "Total Ocupadas", Tipo_ocupacion = "",Porcentaje= sum(Auxxy4.1[,3])))

Auxxy4.2 <- Auxxy4[Auxxy4$Ocupacion %in% 'Desocupadas e inactivas',]
Auxxy4.2 <- Auxxy4.2[order(Auxxy4.2$Porcentaje, decreasing = TRUE), ]
Auxxy4.2 <- rbind(Auxxy4.2,data.frame(Ocupacion = "Total Desocupadas e inactivas", Tipo_ocupacion = "",Porcentaje= sum(Auxxy4.2[,3])))

Auxxy4.3 <- rbind(Auxxy4.1,Auxxy4.2)
Auxxy4.3 <- rbind(Auxxy4.3,data.frame(Ocupacion ="Total",Tipo_ocupacion = "",Porcentaje= round(sum(Auxxy4[,3]),0)))

colnames(Auxxy4.3) <- c("Ocupación","Tipo de ocupación","%")


Tabla6 <-flextable(Auxxy4.3,
         col_keys = names(Auxxy4.3),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

# Tabla6  <- set_header_labels(Tabla6,
#                 values = list(
#                 Ocupacion="Perfil laboral",
#                 Tipo_ocupacion="Ocupacion",
#                 Porcentaje="Porcentaje(%)") )

Tabla6 <- font(Tabla6,fontname='Arial')
Tabla6 <- fontsize(Tabla6, size = 10, part = "header")
Tabla6 <- fontsize(Tabla6, size = 10, part = "body")
Tabla6 <- bold(Tabla6, bold = TRUE, part = "header")

Tabla6 <- merge_v(Tabla6, j = c("Ocupación") )
Tabla6 <- theme_box(Tabla6)
Tabla6 <- bg(Tabla6, i = 1, bg = "mediumpurple1", part = "header")
Tabla6 <- bg(Tabla6, i = ~ Ocupación == "Total", bg = "grey70", part = "body")
Tabla6 <- align(Tabla6, align = "center", part = "header")
Tabla6 <- align(Tabla6,j = c(1,2) ,align = "left", part = "body")
Tabla6 <- align(Tabla6,j = 3 ,align = "right", part = "body")
Tabla6 <- colformat_num(Tabla6, big.mark = " ")
Tabla6 <- bold(Tabla6, i = ~ Ocupación == "Total Ocupadas", bold = TRUE)
Tabla6 <- bg(Tabla6, i = ~ Ocupación == "Total Ocupadas", bg = "grey90", part = "body")
Tabla6 <- bold(Tabla6, i = ~ Ocupación == "Total Desocupadas e inactivas", bold = TRUE)
Tabla6 <- bg(Tabla6, i = ~ Ocupación == "Total Desocupadas e inactivas", bg = "grey90", part = "body")
Tabla6 <- bold(Tabla6, i = ~ Ocupación == "Total", bold = TRUE)
Tabla6 <-autofit(Tabla6) 
Tabla6 

```                                 

Finalmente, es importante destacar que de las personas y colectivos agraviados algunos pertenecen a grupos de atención prioritaria, entre ellos las personas privadas de la libertad, personas con alguna discapacidad, personas en situación de calle, migrantes, personas LGBTTTIQA+, personas indígenas, entre otros grupos. 

**Grupos prioritarios de las personas y colectivos agraviados en servicios proporcionados (SIIGESI), enero-diciembre de 2021 ^[Una persona agraviada puede pertenecer a uno o más grupos de atención prioritaria]**

```{r Tabla7, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}

#Grupos_Servicios <- read_csv("Grupos_prioritarios_personas_servicios_proporcionados(Siigesi)-Ene-Jun-2021.csv")

Grupos_Servicios <- filter(Grupos_Servicios, Caracter %in% c("Agraviado", "Ambos"), Status_gestion %in% c("Concluida"), Tipo_clasificacion_grupo_personas %in% c("Por condición", "Por situación"))

#Grupos_Servicios1  <- Grupos_Servicios  %>% 
#                      mutate(Grupos_prioritarios=case_when(Grupo_personas_G %in% 
#                        c("Personas privadas de su libertad","Mujeres","Personas jóvenes","Víctimas","Personas mayores","Niñas, niños y adolescentes","Personas con discapacidad","Personas LGBTTTI","Personas en situación de calle","Personas de identidad indígena") ~ Grupo_personas_G,
#                      TRUE ~ "Otros grupos"
#                      ))


Tab7 <- table(Grupos_Servicios$Grupo_personas_G, Grupos_Servicios$Sexo)
Tab7 <-   addmargins(Tab7, margin=2)

Tab7 <- data.frame(Tab7)
Tab7 <- reshape(Tab7, timevar = "Var2", idvar = "Var1", direction = "wide")
Tab7  <- Tab7[order(Tab7$Freq.Sum, decreasing = TRUE), ]
Tab7 <- rbind(Tab7[!(Tab7$Var1 %in% "Otros grupos"),],Tab7[(Tab7$Var1 %in% "Otros grupos"),])  

auxServ <- colSums(Tab7[,2:ncol(Tab7)])
auxServ <- data.frame(t(data.frame(auxServ)[1]))
auxServ <- cbind(data.frame(Var1 = "Total"),auxServ)
colnames(auxServ) <- colnames(Tab7)
Tab7 <- rbind(Tab7,auxServ)

Tabla7 <-flextable(Tab7,
         col_keys = names(Tab7),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

 Tabla7  <- set_header_labels(Tabla7,
                values = list(
                Var1="Grupo",
                Freq.Anónimo="Anónimo",
                Freq.Colectivo="Colectivo",
                Freq.Hombre="Hombre",
                Freq.Mujer="Mujer",
                Freq.Sum="Total"))

Tabla7 <- font(Tabla7,fontname='Arial')
Tabla7 <- fontsize(Tabla7, size = 10, part = "header")
Tabla7 <- fontsize(Tabla7, size = 10, part = "body")
Tabla7 <- bold(Tabla7, bold = TRUE, part = "header")

Tabla7 <- theme_box(Tabla7)
Tabla7 <- bg(Tabla7, i = 1, bg = "mediumpurple1", part = "header")
Tabla7 <- bg(Tabla7, i = ~ Var1 == "Total", bg = "grey70", part = "body")
Tabla7 <- align(Tabla7, align = "center", part = "header")
Tabla7 <- align(Tabla7,j = 1 ,align = "left", part = "body")
Tabla7 <- align(Tabla7,j = c(2:ncol(Tab7)) ,align = "right", part = "body")
Tabla7 <- colformat_num(Tabla7, big.mark = " ")
Tabla7 <-autofit(Tabla7) 
Tabla7 <- bold(Tabla7, i = ~ Var1 == "Total", bold = TRUE)
Tabla7 
```
###
###
\pagebreak
Expedientes de queja registrados por calificación según visitaduría general (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaExp, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Expedientes <- Expedientes  %>% 
                mutate (Mes=format(Fecha_creacion ,"%B"))
                     
Expedientes1 <- table(Expedientes[, c("Calificacion", "Nombre_adscripcion")])
Expedientes1 <-   addmargins(Expedientes1, margin=1)
Expedientes1 <-   addmargins(Expedientes1, margin=2)
Expedientes1  <- data.frame(Expedientes1)
Expedientes1 <- Expedientes1[Expedientes1$Freq != 0, ] 
Expedientes1  <- reshape(Expedientes1, timevar = "Nombre_adscripcion", idvar = c("Calificacion") , direction = "wide")
colnames(Expedientes1) <- gsub("Freq.", "", colnames(Expedientes1))
colnames(Expedientes1) <- gsub("Sum", "Total", colnames(Expedientes1))
Expedientes1$Calificacion <- gsub("Sum", "Total", Expedientes1$Calificacion)
Expedientes1 <- Expedientes1[, c(1, 3, 5, 6, 2,4,7)]
Expedientes1[is.na(Expedientes1)] <- 0

TablaExp <-flextable(
         Expedientes1,
         col_keys = names(Expedientes1),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaExp  <- set_header_labels(TablaExp,
                values = list(
                Calificacion="Etapa",
                Sum="Total") )

TablaExp <- font(TablaExp,fontname='Arial')
TablaExp <- fontsize(TablaExp, size = 10, part = "header")
TablaExp <- fontsize(TablaExp, size = 9, part = "body")
TablaExp <- bold(TablaExp, bold = TRUE, part = "header")

TablaExp <- merge_v(TablaExp, j = c("Calificacion") )
TablaExp <- theme_box(TablaExp)
TablaExp <- bg(TablaExp, i = 1, bg = "mediumpurple1", part = "header")
TablaExp <- bg(TablaExp, i = ~ Calificacion == "Total", bg = "grey70", part = "body")
TablaExp <- align(TablaExp, align = "center", part = "header")
TablaExp <- align(TablaExp,j = 1 ,align = "left", part = "body")
TablaExp <- align(TablaExp,j = c(2,3,4,5,6,7) ,align = "right", part = "body")
TablaExp <- colformat_num(TablaExp, big.mark = " ")
TablaExp <-autofit(TablaExp) 
TablaExp <- bold(TablaExp, i = ~ Calificacion == "Total", bold = TRUE)
cat(knit_print(TablaExp %>% width(width = 0.9)))

```
<br>
Personas peticionarias en expedientes de quejas registrados (Siigesi),  `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaExp_Peti, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
#Tabla de personas Peticionarias

Expedientes_Peti <- Expedientes_SPC[Expedientes_SPC$Id_caracter_persona %in% c(1,3),]

Expedientes_Peti1 <- prop.table(table(Expedientes_Peti[, c("Sexo")]),margin = NULL)
Expedientes_Peti1  <- data.frame(Expedientes_Peti1)
Expedientes_Peti1$Freq <- round(Expedientes_Peti1$Freq*100,1)
Expedientes_Peti1.1 <- table(Expedientes_Peti[, c("Sexo")])
Expedientes_Peti1.1  <- data.frame(Expedientes_Peti1.1)
Expedientes_Peti11 <- merge(Expedientes_Peti1.1,Expedientes_Peti1, by="Var1", all.x=TRUE)

Expedientes_Peti11 <- Expedientes_Peti11[Expedientes_Peti1.1$Freq != 0, ] 
Expedientes_Peti11 <- Expedientes_Peti11  %>% mutate (
                         Tipo_Persona=1
                          )
Expedientes_Peti11 <- Expedientes_Peti11[order(Expedientes_Peti1.1$Freq,decreasing = TRUE),]
Expedientes_Peti11  <- reshape(Expedientes_Peti11, timevar = "Var1", idvar = "Tipo_Persona" , direction = "wide")

colnames(Expedientes_Peti11) <- gsub("Freq.x.", "", colnames(Expedientes_Peti11))
colnames(Expedientes_Peti11) <- gsub("Freq.y.", "% ", colnames(Expedientes_Peti11))
Expedientes_Peti11 <- Expedientes_Peti11[, c(2:length(colnames(Expedientes_Peti11)))]
Expedientes_Peti11[is.na(Expedientes_Peti11)] <- 0

TablaExp_Peti <-flextable(
         Expedientes_Peti11,
         col_keys = names(Expedientes_Peti11),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaExp_Peti <- font(TablaExp_Peti,fontname='Arial')
TablaExp_Peti <- fontsize(TablaExp_Peti, size = 10, part = "header")
TablaExp_Peti <- fontsize(TablaExp_Peti, size = 9, part = "body")
TablaExp_Peti <- bold(TablaExp_Peti, bold = TRUE, part = "header")

TablaExp_Peti <- theme_box(TablaExp_Peti)
TablaExp_Peti <- bg(TablaExp_Peti, i = 1, bg = "mediumpurple1", part = "header")
#TablaExp_Peti <- bg(TablaExp_Peti, i = ~ Var1 == "Total", bg = "grey70", part = "body")
TablaExp_Peti <- width(TablaExp_Peti, width = 1.3)
TablaExp_Peti <- align(TablaExp_Peti, align = "center", part = "header")
TablaExp_Peti <- align(TablaExp_Peti, align = "right", part = "body")
TablaExp_Peti <- colformat_num(TablaExp_Peti, big.mark = " ")
TablaExp_Peti <-autofit(TablaExp_Peti) 

cat(knit_print(TablaExp_Peti %>% width(width = 0.8)))
```
<br>
Personas y colectivos agraviados en expedientes de quejas registrados (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaExp_Agr, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
#Tabla de personas Agraviadas
Expedientes_Agr <- Expedientes_SPC[Expedientes_SPC$Id_caracter_persona %in% c(2,3),]

Expedientes_Agr1 <- prop.table(table(Expedientes_Agr[, c("Sexo")]),margin = NULL)
Expedientes_Agr1  <- data.frame(Expedientes_Agr1)
Expedientes_Agr1$Freq <- round(Expedientes_Agr1$Freq*100,1)
Expedientes_Agr1.1 <- table(Expedientes_Agr[, c("Sexo")])
Expedientes_Agr1.1  <- data.frame(Expedientes_Agr1.1)
Expedientes_Agr11 <- merge(Expedientes_Agr1.1,Expedientes_Agr1, by="Var1", all.x=TRUE)

Expedientes_Agr11 <- Expedientes_Agr11[Expedientes_Agr1.1$Freq != 0, ] 

Expedientes_Agr11 <- Expedientes_Agr11  %>% mutate (
                         Tipo_Persona=1
                          )
Expedientes_Agr11 <- Expedientes_Agr11[order(Expedientes_Agr1.1$Freq,decreasing = TRUE),]
Expedientes_Agr11  <- reshape(Expedientes_Agr11, timevar = "Var1", idvar = "Tipo_Persona", direction = "wide")

colnames(Expedientes_Agr11) <- gsub("Freq.x.", "", colnames(Expedientes_Agr11))
colnames(Expedientes_Agr11) <- gsub("Freq.y.", "% ", colnames(Expedientes_Agr11))
Expedientes_Agr11 <- Expedientes_Agr11[, c("Hombre","% Hombre","Mujer","% Mujer","Anónimo","% Anónimo","Colectivo","% Colectivo")]
Expedientes_Agr11[is.na(Expedientes_Agr11)] <- 0

TablaExp_Agr <-flextable(
         Expedientes_Agr11,
         col_keys = names(Expedientes_Agr11),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaExp_Agr <- font(TablaExp_Agr,fontname='Arial')
TablaExp_Agr <- fontsize(TablaExp_Agr, size = 10, part = "header")
TablaExp_Agr <- fontsize(TablaExp_Agr, size = 9, part = "body")
TablaExp_Agr <- bold(TablaExp_Agr, bold = TRUE, part = "header")

TablaExp_Agr <- theme_zebra(TablaExp_Agr, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaExp_Agr <- color(TablaExp_Agr, i = 1, color = "purple4", part = "header")
TablaExp_Agr <- hline(TablaExp_Agr, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaExp_Agr <- hline(TablaExp_Agr, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaExp_Agr <- align(TablaExp_Agr, align = "center", part = "header")
TablaExp_Agr <- align(TablaExp_Agr, align = "right", part = "body")
TablaExp_Agr <- colformat_num(TablaExp_Agr, big.mark = " ")
TablaExp_Agr <-autofit(TablaExp_Agr) 

cat(knit_print(TablaExp_Agr %>% width(width = 0.8)))
```
<br>
Autoridades mencionadas en expedientes de queja registrados (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaAut_G, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
#Autoridades en gestion

Autoridad_gestion_G <- prop.table(table(Autoridad_gestion[, c("Organismo_Generico")]),margin = NULL)
Autoridad_gestion_G  <- data.frame(Autoridad_gestion_G)
Autoridad_gestion_G$Freq <- round(Autoridad_gestion_G$Freq*100,1)
Autoridad_gestion_G.1 <- table(Autoridad_gestion[, c("Organismo_Generico")])
Autoridad_gestion_G.1  <- data.frame(Autoridad_gestion_G.1)
Autoridad_gestion_G1 <- merge(Autoridad_gestion_G.1,Autoridad_gestion_G, by="Var1", all.x=TRUE)

Autoridad_gestion_G1 <- Autoridad_gestion_G1[Autoridad_gestion_G.1$Freq != 0, ] 
Autoridad_gestion_G1 <- Autoridad_gestion_G1[order(Autoridad_gestion_G1$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Autoridad_gestion_Gtop <- top_n(Autoridad_gestion_G1,5)

#Agrupo el resto de autoridades

Autoridad_gestion_Gtop <- rbind(Autoridad_gestion_Gtop, data.frame(Var1 = "Otros",Freq.x = (sum(Autoridad_gestion_G1[,2]) - sum(Autoridad_gestion_Gtop[,2])),Freq.y = (sum(Autoridad_gestion_G1[,3]) - sum(Autoridad_gestion_Gtop[,3]))))

Autoridad_gestion_Gtop <- rbind(Autoridad_gestion_Gtop, data.frame(Var1 = "Total",Freq.x = sum(Autoridad_gestion_Gtop[,2]), Freq.y = round(sum(Autoridad_gestion_Gtop[,3]),0)))

colnames(Autoridad_gestion_Gtop) <- c("Autoridad","Total","%")

Autoridad_gestion_Gtop[is.na(Autoridad_gestion_Gtop)] <- 0

TablaAut_G <-flextable(
         Autoridad_gestion_Gtop,
         col_keys = names(Autoridad_gestion_Gtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaAut_G <- font(TablaAut_G,fontname='Arial')
TablaAut_G <- fontsize(TablaAut_G, size = 10, part = "header")
TablaAut_G <- fontsize(TablaAut_G, size = 9, part = "body")
TablaAut_G <- bold(TablaAut_G, bold = TRUE, part = "header")

TablaAut_G <- theme_zebra(TablaAut_G, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaAut_G <- color(TablaAut_G, i = 1, color = "purple4", part = "header")
TablaAut_G <- hline(TablaAut_G, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaAut_G <- hline(TablaAut_G, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaAut_G <- align(TablaAut_G, align = "center", part = "header")
TablaAut_G <- align(TablaAut_G,j = 1 ,align = "left", part = "body")
TablaAut_G <- align(TablaAut_G,j = c(2,3) ,align = "right", part = "body")
TablaAut_G <- colformat_num(TablaAut_G, big.mark = " ")
TablaAut_G <- bold(TablaAut_G, i = ~ Autoridad == "Total", bold = TRUE)
TablaAut_G <-autofit(TablaAut_G) 
TablaAut_G
```
<br>
Menciones a derecho en expedientes de queja registrados (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaDer, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
#Derechos 
Derechos_G <- prop.table(table(Derechos[, c("Derecho")]),margin = NULL)
Derechos_G  <- data.frame(Derechos_G)
Derechos_G$Freq <- round(Derechos_G$Freq*100,1)
Derechos_G.1 <- table(Derechos[, c("Derecho")])
Derechos_G.1  <- data.frame(Derechos_G.1)
Derechos_G1 <- merge(Derechos_G.1,Derechos_G, by="Var1", all.x=TRUE)

Derechos_G1 <- Derechos_G1[Derechos_G.1$Freq != 0, ] 
Derechos_G1 <- Derechos_G1[order(Derechos_G1$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Derechos_Gtop <- top_n(Derechos_G1,5)

#Agrupo el resto de autoridades

Derechos_Gtop <- rbind(Derechos_Gtop, data.frame(Var1 = "Otros",Freq.x = (sum(Derechos_G1[,2]) - sum(Derechos_Gtop[,2])),Freq.y = (sum(Derechos_G1[,3]) - sum(Derechos_Gtop[,3]))))

Derechos_Gtop <- rbind(Derechos_Gtop, data.frame(Var1 = "Total",Freq.x = sum(Derechos_Gtop[,2]), Freq.y = round(sum(Derechos_Gtop[,3]),0)))

colnames(Derechos_Gtop) <- c("Derecho","Total","%")

Derechos_Gtop[is.na(Derechos_Gtop)] <- 0

TablaDer_G <-flextable(
         Derechos_Gtop,
         col_keys = names(Derechos_Gtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaDer_G <- font(TablaDer_G,fontname='Arial')
TablaDer_G <- fontsize(TablaDer_G, size = 10, part = "header")
TablaDer_G <- fontsize(TablaDer_G, size = 9, part = "body")
TablaDer_G <- bold(TablaDer_G, bold = TRUE, part = "header")

TablaDer_G <- theme_zebra(TablaDer_G, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaDer_G <- color(TablaDer_G, i = 1, color = "purple4", part = "header")
TablaDer_G <- hline(TablaDer_G, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaDer_G <- hline(TablaDer_G, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaDer_G <- align(TablaDer_G, align = "center", part = "header")
TablaDer_G <- align(TablaDer_G,j = 1 ,align = "left", part = "body")
TablaDer_G <- align(TablaDer_G,j = c(2,3) ,align = "right", part = "body")
TablaDer_G <- colformat_num(TablaDer_G, big.mark = " ")
TablaDer_G <- bold(TablaDer_G, i = ~ Derecho == "Total", bold = TRUE)
TablaDer_G <-autofit(TablaDer_G) 
TablaDer_G
```
<br>
Temáticas señaladas en expedientes de queja registrados (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaExp_Tem, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
#Temáticas señaladas en expedientes de queja registrados 

Expedientes_tematicas1 <- table(Expedientes_tematicas[, c("Tematica_servicio")])
Expedientes_tematicas1  <- data.frame(Expedientes_tematicas1)
Expedientes_tematicas1 <- Expedientes_tematicas1[order(Expedientes_tematicas1$Freq, decreasing = TRUE),]

#Obtengo las 5 temáticas más frecuentes
Expedientes_tematicas_top <- top_n(Expedientes_tematicas1,5)

#Agrupo el resto de autoridades

Expedientes_tematicas_top <- rbind(Expedientes_tematicas_top, data.frame(Var1 = "Otros",Freq = (sum(Expedientes_tematicas1[,2]) - sum(Expedientes_tematicas_top[,2]))))

Expedientes_tematicas_top <- rbind(Expedientes_tematicas_top, data.frame(Var1 = "Total",Freq = sum(Expedientes_tematicas_top[,2])))

colnames(Expedientes_tematicas_top) <- c("Temática","Total")

Expedientes_tematicas_top[is.na(Expedientes_tematicas_top)] <- 0

TablaExp_Tem <-flextable(
         Expedientes_tematicas_top,
         col_keys = names(Expedientes_tematicas_top),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaExp_Tem <- font(TablaExp_Tem,fontname='Arial')
TablaExp_Tem <- fontsize(TablaExp_Tem, size = 10, part = "header")
TablaExp_Tem <- fontsize(TablaExp_Tem, size = 9, part = "body")
TablaExp_Tem <- bold(TablaExp_Tem, bold = TRUE, part = "header")

TablaExp_Tem <- theme_zebra(TablaExp_Tem, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaExp_Tem <- color(TablaExp_Tem, i = 1, color = "purple4", part = "header")
TablaExp_Tem <- hline(TablaExp_Tem, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaExp_Tem <- hline(TablaExp_Tem, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaExp_Tem <- align(TablaExp_Tem, align = "center", part = "header")
TablaExp_Tem <- align(TablaExp_Tem,j = 1 ,align = "left", part = "body")
TablaExp_Tem <- align(TablaExp_Tem,j = 2 ,align = "right", part = "body")
TablaExp_Tem <- colformat_num(TablaExp_Tem, big.mark = " ")
TablaExp_Tem <- bold(TablaExp_Tem, i = ~ Temática == "Total", bold = TRUE)
TablaExp_Tem <-autofit(TablaExp_Tem) 
TablaExp_Tem
```
\pagebreak
Lugar de los hechos en expedientes de queja registrados por alcaldía (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaExp_LH, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Expedientes_LH1 <- table(Expedientes_LH[, c("Municipio")])
Expedientes_LH1  <- data.frame(Expedientes_LH1)
Expedientes_LH1 <- Expedientes_LH1[Expedientes_LH1$Freq != 0, ] 
Expedientes_LH1 <- Expedientes_LH1[order(Expedientes_LH1$Freq,decreasing = TRUE),]
Expedientes_LH1 <- rbind(Expedientes_LH1, data.frame(Var1 = "Total",Freq = sum(Expedientes_LH1[,2])))
colnames(Expedientes_LH1) <- c("Alcaldía","Total")
Expedientes_LH1[is.na(Expedientes_LH1)] <- 0

TablaExpLH <-flextable(
         Expedientes_LH1,
         col_keys = names(Expedientes_LH1),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaExpLH <- font(TablaExpLH,fontname='Arial')
TablaExpLH <- fontsize(TablaExpLH, size = 10, part = "header")
TablaExpLH <- fontsize(TablaExpLH, size = 9, part = "body")
TablaExpLH <- bold(TablaExpLH, bold = TRUE, part = "header")

TablaExpLH <- theme_zebra(TablaExpLH, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaExpLH <- color(TablaExpLH, i = 1, color = "purple4", part = "header")
TablaExpLH <- hline(TablaExpLH, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaExpLH <- hline(TablaExpLH, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaExpLH <- align(TablaExpLH, align = "center", part = "header")
TablaExpLH <- align(TablaExpLH,j = 1 ,align = "left", part = "body")
TablaExpLH <- align(TablaExpLH,j = 2 ,align = "right", part = "body")
TablaExpLH <- colformat_num(TablaExpLH, big.mark = " ")
TablaExpLH <- bold(TablaExpLH, i = ~ Alcaldía == "Total", bold = TRUE)
TablaExpLH <-autofit(TablaExpLH)
TablaExpLH

```
\pagebreak

```{r Medidas_precautorias, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Medidas_precautorias <- Medidas_precautorias %>% 
                        mutate( Id_adscripcion=case_when(
                        Adscripcion=="Primera Visitaduría" ~ 1,
                        Adscripcion=="Segunda Visitaduría" ~ 2,
                        Adscripcion=="Tercera Visitaduría" ~ 3,
                        Adscripcion=="Cuarta Visitaduría"  ~ 4,
                        Adscripcion=="Quinta Visitaduría"  ~ 5)
                        )

Tab8 <- table(Medidas_precautorias$Id_adscripcion, Medidas_precautorias$Activo)

Tab8 <-  addmargins(Tab8, margin=1)
Tab8 <-  addmargins(Tab8, margin=2)
Tab8 <- data.frame(Tab8)
Tab8 <- reshape(Tab8, timevar = "Var2", idvar = "Var1", direction = "wide")

MP_1VG <- filter(Medidas_precautorias, Id_adscripcion==1)
MP_2VG <- filter(Medidas_precautorias, Id_adscripcion==2)
MP_3VG <- filter(Medidas_precautorias, Id_adscripcion==3)
MP_4VG <- filter(Medidas_precautorias, Id_adscripcion==4)
MP_5VG <- filter(Medidas_precautorias, Id_adscripcion==5)


Tab8.1 <- ftable(MP_1VG[, c("Id_adscripcion", "Organismo_Generico", "Activo")]) 
Tab8.1 <- data.frame(Tab8.1)
Tab8.1 <- Tab8.1[order(Tab8.1$Id_adscripcion, -Tab8.1$Freq), ]

Tab8.2 <- ftable(MP_2VG[, c("Id_adscripcion", "Organismo_Generico", "Activo")]) 
Tab8.2 <- data.frame(Tab8.2)
Tab8.2 <- Tab8.2[order(Tab8.2$Id_adscripcion, -Tab8.2$Freq), ]

Tab8.3 <- ftable(MP_3VG[, c("Id_adscripcion", "Organismo_Generico", "Activo")]) 
Tab8.3 <- data.frame(Tab8.3)
Tab8.3 <- Tab8.3[order(Tab8.3$Id_adscripcion, -Tab8.3$Freq), ]

Tab8.4 <- ftable(MP_4VG[, c("Id_adscripcion", "Organismo_Generico", "Activo")]) 
Tab8.4 <- data.frame(Tab8.4)
Tab8.4 <- Tab8.4[order(Tab8.4$Id_adscripcion, -Tab8.4$Freq), ]

Tab8.5 <- ftable(MP_5VG[, c("Id_adscripcion", "Organismo_Generico", "Activo")]) 
Tab8.5 <- data.frame(Tab8.5)
Tab8.5 <- Tab8.5[order(Tab8.5$Id_adscripcion, -Tab8.5$Freq), ]

```
**PRIMERA VISITADURÍA**

Expedientes de queja en la 1VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaExp_1VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Expedientes1VG <- Expedientes[Expedientes$Id_adscripcion %in% 1,]

Expedientes1VG <- table(Expedientes1VG[, c("Calificacion")])
Expedientes1VG <-   addmargins(Expedientes1VG, margin=1)
Expedientes1VG  <- data.frame(Expedientes1VG)
Expedientes1VG <- Expedientes1VG[Expedientes1VG$Freq != 0, ] 
colnames(Expedientes1VG) <- c("Etapa","Total")
Expedientes1VG$Etapa <- gsub("Sum", "Total", Expedientes1VG$Etapa)
Expedientes1VG[is.na(Expedientes1VG)] <- 0

TablaExp1VG <-flextable(
         Expedientes1VG,
         col_keys = names(Expedientes1VG),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaExp1VG <- font(TablaExp1VG,fontname='Arial')
TablaExp1VG <- fontsize(TablaExp1VG, size = 10, part = "header")
TablaExp1VG <- fontsize(TablaExp1VG, size = 9, part = "body")
TablaExp1VG <- bold(TablaExp1VG, bold = TRUE, part = "header")

TablaExp1VG <- merge_v(TablaExp1VG, j = c("Etapa") )
TablaExp1VG <- theme_zebra(TablaExp1VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaExp1VG <- color(TablaExp1VG, i = 1, color = "purple4", part = "header")
TablaExp1VG <- hline(TablaExp1VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaExp1VG <- hline(TablaExp1VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaExp1VG <- align(TablaExp1VG, align = "center", part = "header")
TablaExp1VG <- align(TablaExp1VG,j = 1 ,align = "left", part = "body")
TablaExp1VG <- align(TablaExp1VG,j = 2 ,align = "right", part = "body")
TablaExp1VG <- colformat_num(TablaExp1VG, big.mark = " ")
TablaExp1VG <- bold(TablaExp1VG, i = ~ Etapa == "Total", bold = TRUE)
TablaExp1VG <-autofit(TablaExp1VG)
TablaExp1VG
```
<br>
Autoridades señaladas en expedientes de queja en la 1VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaAut_1VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
#Autoridades en gestion 1VG
Autoridad_gestion_1VG <- Autoridad_gestion[Autoridad_gestion$Id_adscripcion %in% 1,]

Autoridad_gestion_1VG1 <- prop.table(table(Autoridad_gestion_1VG[, c("Organismo_Generico")]),margin = NULL)
Autoridad_gestion_1VG1  <- data.frame(Autoridad_gestion_1VG1)
Autoridad_gestion_1VG1$Freq <- round(Autoridad_gestion_1VG1$Freq*100,1)
Autoridad_gestion_1VG.1 <- table(Autoridad_gestion_1VG[, c("Organismo_Generico")])
Autoridad_gestion_1VG.1  <- data.frame(Autoridad_gestion_1VG.1)
Autoridad_gestion_1VGG <- merge(Autoridad_gestion_1VG.1,Autoridad_gestion_1VG1, by="Var1", all.x=TRUE)

Autoridad_gestion_1VGG <- Autoridad_gestion_1VGG[Autoridad_gestion_1VG.1$Freq != 0, ] 
Autoridad_gestion_1VGG <- Autoridad_gestion_1VGG[order(Autoridad_gestion_1VGG$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Autoridad_gestion_1VGtop <- top_n(Autoridad_gestion_1VGG,5)

#Agrupo el resto de autoridades

Autoridad_gestion_1VGtop <- rbind(Autoridad_gestion_1VGtop, data.frame(Var1 = "Otros",Freq.x = (sum(Autoridad_gestion_1VGG[,2]) - sum(Autoridad_gestion_1VGtop[,2])),Freq.y = (sum(Autoridad_gestion_1VGG[,3]) - sum(Autoridad_gestion_1VGtop[,3]))))

Autoridad_gestion_1VGtop <- rbind(Autoridad_gestion_1VGtop, data.frame(Var1 = "Total",Freq.x = sum(Autoridad_gestion_1VGtop[,2]), Freq.y = round(sum(Autoridad_gestion_1VGtop[,3]),0)))

colnames(Autoridad_gestion_1VGtop) <- c("Autoridad","Total","%")

Autoridad_gestion_1VGtop[is.na(Autoridad_gestion_1VGtop)] <- 0

TablaAut_1VG <-flextable(
         Autoridad_gestion_1VGtop,
         col_keys = names(Autoridad_gestion_1VGtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaAut_1VG <- font(TablaAut_1VG,fontname='Arial')
TablaAut_1VG <- fontsize(TablaAut_1VG, size = 10, part = "header")
TablaAut_1VG <- fontsize(TablaAut_1VG, size = 9, part = "body")
TablaAut_1VG <- bold(TablaAut_1VG, bold = TRUE, part = "header")

TablaAut_1VG <- theme_zebra(TablaAut_1VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaAut_1VG <- color(TablaAut_1VG, i = 1, color = "purple4", part = "header")
TablaAut_1VG <- hline(TablaAut_1VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaAut_1VG <- hline(TablaAut_1VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaAut_1VG <- align(TablaAut_1VG, align = "center", part = "header")
TablaAut_1VG <- align(TablaAut_1VG,j = 1 ,align = "left", part = "body")
TablaAut_1VG <- align(TablaAut_1VG,j = c(2,3) ,align = "right", part = "body")
TablaAut_1VG <- colformat_num(TablaAut_1VG, big.mark = " ")
TablaAut_1VG <- bold(TablaAut_1VG, i = ~ Autoridad == "Total", bold = TRUE)
TablaAut_1VG <-autofit(TablaAut_1VG) 
TablaAut_1VG
```
<br>Menciones a derecho en expedientes de queja en la 1VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaDer_1VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Derechos_1VG <- Derechos[Derechos$Id_adscripcion %in% 1,]

Derechos_1VG1 <- prop.table(table(Derechos_1VG[, c("Derecho")]),margin = NULL)
Derechos_1VG1  <- data.frame(Derechos_1VG1)
Derechos_1VG1$Freq <- round(Derechos_1VG1$Freq*100,1)
Derechos_1VG.1 <- table(Derechos_1VG[, c("Derecho")])
Derechos_1VG.1  <- data.frame(Derechos_1VG.1)
Derechos_1VGG <- merge(Derechos_1VG.1,Derechos_1VG1, by="Var1", all.x=TRUE)

Derechos_1VGG <- Derechos_1VGG[Derechos_1VG.1$Freq != 0, ] 
Derechos_1VGG <- Derechos_1VGG[order(Derechos_1VGG$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Derechos_1VGtop <- top_n(Derechos_1VGG,5)

#Agrupo el resto de autoridades

Derechos_1VGtop <- rbind(Derechos_1VGtop, data.frame(Var1 = "Otros",Freq.x = (sum(Derechos_1VGG[,2]) - sum(Derechos_1VGtop[,2])),Freq.y = (sum(Derechos_1VGG[,3]) - sum(Derechos_1VGtop[,3]))))

Derechos_1VGtop <- rbind(Derechos_1VGtop, data.frame(Var1 = "Total",Freq.x = sum(Derechos_1VGtop[,2]), Freq.y = round(sum(Derechos_1VGtop[,3]),0)))

colnames(Derechos_1VGtop) <- c("Derecho","Total","%")

Derechos_1VGtop[is.na(Derechos_1VGtop)] <- 0

TablaDer_1VG <-flextable(
         Derechos_1VGtop,
         col_keys = names(Derechos_1VGtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaDer_1VG <- font(TablaDer_1VG,fontname='Arial')
TablaDer_1VG <- fontsize(TablaDer_1VG, size = 10, part = "header")
TablaDer_1VG <- fontsize(TablaDer_1VG, size = 9, part = "body")
TablaDer_1VG <- bold(TablaDer_1VG, bold = TRUE, part = "header")

TablaDer_1VG <- theme_zebra(TablaDer_1VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaDer_1VG <- color(TablaDer_1VG, i = 1, color = "purple4", part = "header")
TablaDer_1VG <- hline(TablaDer_1VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaDer_1VG <- hline(TablaDer_1VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaDer_1VG <- align(TablaDer_1VG, align = "center", part = "header")
TablaDer_1VG <- align(TablaDer_1VG,j = 1 ,align = "left", part = "body")
TablaDer_1VG <- align(TablaDer_1VG,j = c(2,3) ,align = "right", part = "body")
TablaDer_1VG <- colformat_num(TablaDer_1VG, big.mark = " ")
TablaDer_1VG <- bold(TablaDer_1VG, i = ~ Derecho == "Total", bold = TRUE)
TablaDer_1VG <-autofit(TablaDer_1VG) 
TablaDer_1VG
```
**MEDIDAS PRECAUTORIAS**

**Primera Visitaduría**

Durante el año 2021, la 1VG tramitó `r paste0(formatC(Tab8[1,3], big.mark = " "))` solicitudes de medidas precautorias. Las principales autoridades que encabezan la lista de recepción de dichas solicitudes durante el periodo señalado son la `r paste0(Tab8.1[1,2])`, `r paste0(Tab8.1[2,2])`, y la `r paste0(Tab8.1[3,2])`.
\pagebreak

**SEGUNDA VISITADURÍA**

Expedientes de queja en la 2VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaExp_2VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Expedientes2VG <- Expedientes[Expedientes$Id_adscripcion %in% 2,]

Expedientes2VG <- table(Expedientes2VG[, c("Calificacion")])
Expedientes2VG <-   addmargins(Expedientes2VG, margin=1)
Expedientes2VG  <- data.frame(Expedientes2VG)
Expedientes2VG <- Expedientes2VG[Expedientes2VG$Freq != 0, ] 
colnames(Expedientes2VG) <- c("Etapa","Total")
Expedientes2VG$Etapa <- gsub("Sum", "Total", Expedientes2VG$Etapa)
Expedientes2VG[is.na(Expedientes2VG)] <- 0

TablaExp2VG <-flextable(
         Expedientes2VG,
         col_keys = names(Expedientes2VG),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaExp2VG <- font(TablaExp2VG,fontname='Arial')
TablaExp2VG <- fontsize(TablaExp2VG, size = 10, part = "header")
TablaExp2VG <- fontsize(TablaExp2VG, size = 9, part = "body")
TablaExp2VG <- bold(TablaExp2VG, bold = TRUE, part = "header")

TablaExp2VG <- merge_v(TablaExp2VG, j = c("Etapa") )
TablaExp2VG <- theme_zebra(TablaExp2VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaExp2VG <- color(TablaExp2VG, i = 1, color = "purple4", part = "header")
TablaExp2VG <- hline(TablaExp2VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaExp2VG <- hline(TablaExp2VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaExp2VG <- align(TablaExp2VG, align = "center", part = "header")
TablaExp2VG <- align(TablaExp2VG,j = 1 ,align = "left", part = "body")
TablaExp2VG <- align(TablaExp2VG,j = 2 ,align = "right", part = "body")
TablaExp2VG <- colformat_num(TablaExp2VG, big.mark = " ")
TablaExp2VG <- bold(TablaExp2VG, i = ~ Etapa == "Total", bold = TRUE)
TablaExp2VG <-autofit(TablaExp2VG)
TablaExp2VG
```
<br>
Autoridades señaladas en expedientes de queja en la 2VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaAut_2VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
#Autoridades en gestion 2VG
Autoridad_gestion_2VG <- Autoridad_gestion[Autoridad_gestion$Id_adscripcion %in% 2,]

Autoridad_gestion_2VG1 <- prop.table(table(Autoridad_gestion_2VG[, c("Organismo_Generico")]),margin = NULL)
Autoridad_gestion_2VG1  <- data.frame(Autoridad_gestion_2VG1)
Autoridad_gestion_2VG1$Freq <- round(Autoridad_gestion_2VG1$Freq*100,1)
Autoridad_gestion_2VG.1 <- table(Autoridad_gestion_2VG[, c("Organismo_Generico")])
Autoridad_gestion_2VG.1  <- data.frame(Autoridad_gestion_2VG.1)
Autoridad_gestion_2VGG <- merge(Autoridad_gestion_2VG.1,Autoridad_gestion_2VG1, by="Var1", all.x=TRUE)

Autoridad_gestion_2VGG <- Autoridad_gestion_2VGG[Autoridad_gestion_2VG.1$Freq != 0, ] 
Autoridad_gestion_2VGG <- Autoridad_gestion_2VGG[order(Autoridad_gestion_2VGG$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Autoridad_gestion_2VGtop <- top_n(Autoridad_gestion_2VGG,5)

#Agrupo el resto de autoridades

Autoridad_gestion_2VGtop <- rbind(Autoridad_gestion_2VGtop, data.frame(Var1 = "Otros",Freq.x = (sum(Autoridad_gestion_2VGG[,2]) - sum(Autoridad_gestion_2VGtop[,2])),Freq.y = (sum(Autoridad_gestion_2VGG[,3]) - sum(Autoridad_gestion_2VGtop[,3]))))

Autoridad_gestion_2VGtop <- rbind(Autoridad_gestion_2VGtop, data.frame(Var1 = "Total",Freq.x = sum(Autoridad_gestion_2VGtop[,2]), Freq.y = round(sum(Autoridad_gestion_2VGtop[,3]),0)))

colnames(Autoridad_gestion_2VGtop) <- c("Autoridad","Total","%")

Autoridad_gestion_2VGtop[is.na(Autoridad_gestion_2VGtop)] <- 0

TablaAut_2VG <-flextable(
         Autoridad_gestion_2VGtop,
         col_keys = names(Autoridad_gestion_2VGtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaAut_2VG <- font(TablaAut_2VG,fontname='Arial')
TablaAut_2VG <- fontsize(TablaAut_2VG, size = 10, part = "header")
TablaAut_2VG <- fontsize(TablaAut_2VG, size = 9, part = "body")
TablaAut_2VG <- bold(TablaAut_2VG, bold = TRUE, part = "header")

TablaAut_2VG <- theme_zebra(TablaAut_2VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaAut_2VG <- color(TablaAut_2VG, i = 1, color = "purple4", part = "header")
TablaAut_2VG <- hline(TablaAut_2VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaAut_2VG <- hline(TablaAut_2VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaAut_2VG <- align(TablaAut_2VG, align = "center", part = "header")
TablaAut_2VG <- align(TablaAut_2VG,j = 1 ,align = "left", part = "body")
TablaAut_2VG <- align(TablaAut_2VG,j = c(2,3) ,align = "right", part = "body")
TablaAut_2VG <- colformat_num(TablaAut_2VG, big.mark = " ")
TablaAut_2VG <- bold(TablaAut_2VG, i = ~ Autoridad == "Total", bold = TRUE)
TablaAut_2VG <-autofit(TablaAut_2VG) 
TablaAut_2VG
```
<br>
Menciones a derecho en expedientes de queja en la 2VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaDer_2VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Derechos_2VG <- Derechos[Derechos$Id_adscripcion %in% 2,]

Derechos_2VG1 <- prop.table(table(Derechos_2VG[, c("Derecho")]),margin = NULL)
Derechos_2VG1  <- data.frame(Derechos_2VG1)
Derechos_2VG1$Freq <- round(Derechos_2VG1$Freq*100,1)
Derechos_2VG.1 <- table(Derechos_2VG[, c("Derecho")])
Derechos_2VG.1  <- data.frame(Derechos_2VG.1)
Derechos_2VGG <- merge(Derechos_2VG.1,Derechos_2VG1, by="Var1", all.x=TRUE)

Derechos_2VGG <- Derechos_2VGG[Derechos_2VG.1$Freq != 0, ] 
Derechos_2VGG <- Derechos_2VGG[order(Derechos_2VGG$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Derechos_2VGtop <- top_n(Derechos_2VGG,5)

#Agrupo el resto de autoridades

Derechos_2VGtop <- rbind(Derechos_2VGtop, data.frame(Var1 = "Otros",Freq.x = (sum(Derechos_2VGG[,2]) - sum(Derechos_2VGtop[,2])),Freq.y = (sum(Derechos_2VGG[,3]) - sum(Derechos_2VGtop[,3]))))

Derechos_2VGtop <- rbind(Derechos_2VGtop, data.frame(Var1 = "Total",Freq.x = sum(Derechos_2VGtop[,2]), Freq.y = round(sum(Derechos_2VGtop[,3]),0)))

colnames(Derechos_2VGtop) <- c("Derecho","Total","%")

Derechos_2VGtop[is.na(Derechos_2VGtop)] <- 0

TablaDer_2VG <-flextable(
         Derechos_2VGtop,
         col_keys = names(Derechos_2VGtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaDer_2VG <- font(TablaDer_2VG,fontname='Arial')
TablaDer_2VG <- fontsize(TablaDer_2VG, size = 10, part = "header")
TablaDer_2VG <- fontsize(TablaDer_2VG, size = 9, part = "body")
TablaDer_2VG <- bold(TablaDer_2VG, bold = TRUE, part = "header")

TablaDer_2VG <- theme_zebra(TablaDer_2VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaDer_2VG <- color(TablaDer_2VG, i = 1, color = "purple4", part = "header")
TablaDer_2VG <- hline(TablaDer_2VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaDer_2VG <- hline(TablaDer_2VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaDer_2VG <- align(TablaDer_2VG, align = "center", part = "header")
TablaDer_2VG <- align(TablaDer_2VG,j = 1 ,align = "left", part = "body")
TablaDer_2VG <- align(TablaDer_2VG,j = c(2,3) ,align = "right", part = "body")
TablaDer_2VG <- colformat_num(TablaDer_2VG, big.mark = " ")
TablaDer_2VG <- bold(TablaDer_2VG, i = ~ Derecho == "Total", bold = TRUE)
TablaDer_2VG <-autofit(TablaDer_2VG) 
TablaDer_2VG
```

**MEDIDAS PRECAUTORIAS**

**Segunda Visitaduría**

Durante el año 2021, la 2VG tramitó `r paste0(formatC(Tab8[2,3], big.mark = " "))` solicitudes de medidas precautorias. Las principales autoridades que encabezan la lista de recepción de dichas solicitudes durante el periodo señalado son la `r paste0(Tab8.2[1,2])`, `r paste0(Tab8.2[2,2])`, y la `r paste0(Tab8.2[3,2])`.
\pagebreak

**TERCERA VISITADURÍA**

Expedientes de queja en la 3VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaExp_3VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Expedientes3VG <- Expedientes[Expedientes$Id_adscripcion %in% 3,]

Expedientes3VG <- table(Expedientes3VG[, c("Calificacion")])
Expedientes3VG <-   addmargins(Expedientes3VG, margin=1)
Expedientes3VG  <- data.frame(Expedientes3VG)
Expedientes3VG <- Expedientes3VG[Expedientes3VG$Freq != 0, ] 
colnames(Expedientes3VG) <- c("Etapa","Total")
Expedientes3VG$Etapa <- gsub("Sum", "Total", Expedientes3VG$Etapa)
Expedientes3VG[is.na(Expedientes3VG)] <- 0

TablaExp3VG <-flextable(
         Expedientes3VG,
         col_keys = names(Expedientes3VG),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaExp3VG <- font(TablaExp3VG,fontname='Arial')
TablaExp3VG <- fontsize(TablaExp3VG, size = 10, part = "header")
TablaExp3VG <- fontsize(TablaExp3VG, size = 9, part = "body")
TablaExp3VG <- bold(TablaExp3VG, bold = TRUE, part = "header")

TablaExp3VG <- merge_v(TablaExp3VG, j = c("Etapa") )
TablaExp3VG <- theme_zebra(TablaExp3VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaExp3VG <- color(TablaExp3VG, i = 1, color = "purple4", part = "header")
TablaExp3VG <- hline(TablaExp3VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaExp3VG <- hline(TablaExp3VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaExp3VG <- align(TablaExp3VG, align = "center", part = "header")
TablaExp3VG <- align(TablaExp3VG,j = 1 ,align = "left", part = "body")
TablaExp3VG <- align(TablaExp3VG,j = 2 ,align = "right", part = "body")
TablaExp3VG <- colformat_num(TablaExp3VG, big.mark = " ")
TablaExp3VG <- bold(TablaExp3VG, i = ~ Etapa == "Total", bold = TRUE)
TablaExp3VG <-autofit(TablaExp3VG)
TablaExp3VG
```
<br>
Autoridades señaladas en expedientes de queja en la 3VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaAut_3VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
#Autoridades en gestion 3VG
Autoridad_gestion_3VG <- Autoridad_gestion[Autoridad_gestion$Id_adscripcion %in% 3,]

Autoridad_gestion_3VG1 <- prop.table(table(Autoridad_gestion_3VG[, c("Organismo_Generico")]),margin = NULL)
Autoridad_gestion_3VG1  <- data.frame(Autoridad_gestion_3VG1)
Autoridad_gestion_3VG1$Freq <- round(Autoridad_gestion_3VG1$Freq*100,1)
Autoridad_gestion_3VG.1 <- table(Autoridad_gestion_3VG[, c("Organismo_Generico")])
Autoridad_gestion_3VG.1  <- data.frame(Autoridad_gestion_3VG.1)
Autoridad_gestion_3VGG <- merge(Autoridad_gestion_3VG.1,Autoridad_gestion_3VG1, by="Var1", all.x=TRUE)

Autoridad_gestion_3VGG <- Autoridad_gestion_3VGG[Autoridad_gestion_3VG.1$Freq != 0, ] 
Autoridad_gestion_3VGG <- Autoridad_gestion_3VGG[order(Autoridad_gestion_3VGG$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Autoridad_gestion_3VGtop <- top_n(Autoridad_gestion_3VGG,5)

#Agrupo el resto de autoridades

Autoridad_gestion_3VGtop <- rbind(Autoridad_gestion_3VGtop, data.frame(Var1 = "Otros",Freq.x = (sum(Autoridad_gestion_3VGG[,2]) - sum(Autoridad_gestion_3VGtop[,2])),Freq.y = (sum(Autoridad_gestion_3VGG[,3]) - sum(Autoridad_gestion_3VGtop[,3]))))

Autoridad_gestion_3VGtop <- rbind(Autoridad_gestion_3VGtop, data.frame(Var1 = "Total",Freq.x = sum(Autoridad_gestion_3VGtop[,2]), Freq.y = round(sum(Autoridad_gestion_3VGtop[,3]),0)))

colnames(Autoridad_gestion_3VGtop) <- c("Autoridad","Total","%")

Autoridad_gestion_3VGtop[is.na(Autoridad_gestion_3VGtop)] <- 0

TablaAut_3VG <-flextable(
         Autoridad_gestion_3VGtop,
         col_keys = names(Autoridad_gestion_3VGtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaAut_3VG <- font(TablaAut_3VG,fontname='Arial')
TablaAut_3VG <- fontsize(TablaAut_3VG, size = 10, part = "header")
TablaAut_3VG <- fontsize(TablaAut_3VG, size = 9, part = "body")
TablaAut_3VG <- bold(TablaAut_3VG, bold = TRUE, part = "header")

TablaAut_3VG <- theme_zebra(TablaAut_3VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaAut_3VG <- color(TablaAut_3VG, i = 1, color = "purple4", part = "header")
TablaAut_3VG <- hline(TablaAut_3VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaAut_3VG <- hline(TablaAut_3VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaAut_3VG <- align(TablaAut_3VG, align = "center", part = "header")
TablaAut_3VG <- align(TablaAut_3VG,j = 1 ,align = "left", part = "body")
TablaAut_3VG <- align(TablaAut_3VG,j = c(2,3) ,align = "right", part = "body")
TablaAut_3VG <- colformat_num(TablaAut_3VG, big.mark = " ")
TablaAut_3VG <- bold(TablaAut_3VG, i = ~ Autoridad == "Total", bold = TRUE)
TablaAut_3VG <-autofit(TablaAut_3VG) 
TablaAut_3VG
```
<br>
Menciones a derecho en expedientes de queja en la 3VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaDer_3VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Derechos_3VG <- Derechos[Derechos$Id_adscripcion %in% 3,]

Derechos_3VG1 <- prop.table(table(Derechos_3VG[, c("Derecho")]),margin = NULL)
Derechos_3VG1  <- data.frame(Derechos_3VG1)
Derechos_3VG1$Freq <- round(Derechos_3VG1$Freq*100,1)
Derechos_3VG.1 <- table(Derechos_3VG[, c("Derecho")])
Derechos_3VG.1  <- data.frame(Derechos_3VG.1)
Derechos_3VGG <- merge(Derechos_3VG.1,Derechos_3VG1, by="Var1", all.x=TRUE)

Derechos_3VGG <- Derechos_3VGG[Derechos_3VG.1$Freq != 0, ] 
Derechos_3VGG <- Derechos_3VGG[order(Derechos_3VGG$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Derechos_3VGtop <- top_n(Derechos_3VGG,5)

#Agrupo el resto de autoridades

Derechos_3VGtop <- rbind(Derechos_3VGtop, data.frame(Var1 = "Otros",Freq.x = (sum(Derechos_3VGG[,2]) - sum(Derechos_3VGtop[,2])),Freq.y = (sum(Derechos_3VGG[,3]) - sum(Derechos_3VGtop[,3]))))

Derechos_3VGtop <- rbind(Derechos_3VGtop, data.frame(Var1 = "Total",Freq.x = sum(Derechos_3VGtop[,2]), Freq.y = round(sum(Derechos_3VGtop[,3]),0)))

colnames(Derechos_3VGtop) <- c("Derecho","Total","%")

Derechos_3VGtop[is.na(Derechos_3VGtop)] <- 0

TablaDer_3VG <-flextable(
         Derechos_3VGtop,
         col_keys = names(Derechos_3VGtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaDer_3VG <- font(TablaDer_3VG,fontname='Arial')
TablaDer_3VG <- fontsize(TablaDer_3VG, size = 10, part = "header")
TablaDer_3VG <- fontsize(TablaDer_3VG, size = 9, part = "body")
TablaDer_3VG <- bold(TablaDer_3VG, bold = TRUE, part = "header")

TablaDer_3VG <- theme_zebra(TablaDer_3VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaDer_3VG <- color(TablaDer_3VG, i = 1, color = "purple4", part = "header")
TablaDer_3VG <- hline(TablaDer_3VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaDer_3VG <- hline(TablaDer_3VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaDer_3VG <- align(TablaDer_3VG, align = "center", part = "header")
TablaDer_3VG <- align(TablaDer_3VG,j = 1 ,align = "left", part = "body")
TablaDer_3VG <- align(TablaDer_3VG,j = c(2,3) ,align = "right", part = "body")
TablaDer_3VG <- colformat_num(TablaDer_3VG, big.mark = " ")
TablaDer_3VG <- bold(TablaDer_3VG, i = ~ Derecho == "Total", bold = TRUE)
TablaDer_3VG <-autofit(TablaDer_3VG) 
TablaDer_3VG
```
**MEDIDAS PRECAUTORIAS**

**Tercera Visitaduría**

Durante el año 2021, la 3VG tramitó `r paste0(formatC(Tab8[3,3], big.mark = " "))` solicitudes de medidas precautorias. Las principales autoridades que encabezan la lista de recepción de dichas solicitudes durante el periodo señalado son la `r paste0(Tab8.3[1,2])`, `r paste0(Tab8.3[2,2])`, y la `r paste0(Tab8.3[3,2])`.


\pagebreak

**CUARTA VISITADURÍA**

Expedientes de queja en la 4VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaExp_4VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Expedientes4VG <- Expedientes[Expedientes$Id_adscripcion %in% 4,]

Expedientes4VG <- table(Expedientes4VG[, c("Calificacion")])
Expedientes4VG <-   addmargins(Expedientes4VG, margin=1)
Expedientes4VG  <- data.frame(Expedientes4VG)
Expedientes4VG <- Expedientes4VG[Expedientes4VG$Freq != 0, ] 
colnames(Expedientes4VG) <- c("Etapa","Total")
Expedientes4VG$Etapa <- gsub("Sum", "Total", Expedientes4VG$Etapa)
Expedientes4VG[is.na(Expedientes4VG)] <- 0

TablaExp4VG <-flextable(
         Expedientes4VG,
         col_keys = names(Expedientes4VG),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaExp4VG <- font(TablaExp4VG,fontname='Arial')
TablaExp4VG <- fontsize(TablaExp4VG, size = 10, part = "header")
TablaExp4VG <- fontsize(TablaExp4VG, size = 9, part = "body")
TablaExp4VG <- bold(TablaExp4VG, bold = TRUE, part = "header")

TablaExp4VG <- merge_v(TablaExp4VG, j = c("Etapa") )
TablaExp4VG <- theme_zebra(TablaExp4VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaExp4VG <- color(TablaExp4VG, i = 1, color = "purple4", part = "header")
TablaExp4VG <- hline(TablaExp4VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaExp4VG <- hline(TablaExp4VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaExp4VG <- align(TablaExp4VG, align = "center", part = "header")
TablaExp4VG <- align(TablaExp4VG,j = 1 ,align = "left", part = "body")
TablaExp4VG <- align(TablaExp4VG,j = 2 ,align = "right", part = "body")
TablaExp4VG <- colformat_num(TablaExp4VG, big.mark = " ")
TablaExp4VG <- bold(TablaExp4VG, i = ~ Etapa == "Total", bold = TRUE)
TablaExp4VG <-autofit(TablaExp4VG)
TablaExp4VG
```
<br>
Autoridades señaladas en expedientes de queja en la 4VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaAut_4VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
#Autoridades en gestion 4VG
Autoridad_gestion_4VG <- Autoridad_gestion[Autoridad_gestion$Id_adscripcion %in% 4,]

Autoridad_gestion_4VG1 <- prop.table(table(Autoridad_gestion_4VG[, c("Organismo_Generico")]),margin = NULL)
Autoridad_gestion_4VG1  <- data.frame(Autoridad_gestion_4VG1)
Autoridad_gestion_4VG1$Freq <- round(Autoridad_gestion_4VG1$Freq*100,1)
Autoridad_gestion_4VG.1 <- table(Autoridad_gestion_4VG[, c("Organismo_Generico")])
Autoridad_gestion_4VG.1  <- data.frame(Autoridad_gestion_4VG.1)
Autoridad_gestion_4VGG <- merge(Autoridad_gestion_4VG.1,Autoridad_gestion_4VG1, by="Var1", all.x=TRUE)

Autoridad_gestion_4VGG <- Autoridad_gestion_4VGG[Autoridad_gestion_4VG.1$Freq != 0, ] 
Autoridad_gestion_4VGG <- Autoridad_gestion_4VGG[order(Autoridad_gestion_4VGG$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Autoridad_gestion_4VGtop <- top_n(Autoridad_gestion_4VGG,5)

#Agrupo el resto de autoridades

Autoridad_gestion_4VGtop <- rbind(Autoridad_gestion_4VGtop, data.frame(Var1 = "Otros",Freq.x = (sum(Autoridad_gestion_4VGG[,2]) - sum(Autoridad_gestion_4VGtop[,2])),Freq.y = (sum(Autoridad_gestion_4VGG[,3]) - sum(Autoridad_gestion_4VGtop[,3]))))

Autoridad_gestion_4VGtop <- rbind(Autoridad_gestion_4VGtop, data.frame(Var1 = "Total",Freq.x = sum(Autoridad_gestion_4VGtop[,2]), Freq.y = round(sum(Autoridad_gestion_4VGtop[,3]),0)))

colnames(Autoridad_gestion_4VGtop) <- c("Autoridad","Total","%")

Autoridad_gestion_4VGtop[is.na(Autoridad_gestion_4VGtop)] <- 0

TablaAut_4VG <-flextable(
         Autoridad_gestion_4VGtop,
         col_keys = names(Autoridad_gestion_4VGtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaAut_4VG <- font(TablaAut_4VG,fontname='Arial')
TablaAut_4VG <- fontsize(TablaAut_4VG, size = 10, part = "header")
TablaAut_4VG <- fontsize(TablaAut_4VG, size = 9, part = "body")
TablaAut_4VG <- bold(TablaAut_4VG, bold = TRUE, part = "header")

TablaAut_4VG <- theme_zebra(TablaAut_4VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaAut_4VG <- color(TablaAut_4VG, i = 1, color = "purple4", part = "header")
TablaAut_4VG <- hline(TablaAut_4VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaAut_4VG <- hline(TablaAut_4VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaAut_4VG <- align(TablaAut_4VG, align = "center", part = "header")
TablaAut_4VG <- align(TablaAut_4VG,j = 1 ,align = "left", part = "body")
TablaAut_4VG <- align(TablaAut_4VG,j = c(2,3) ,align = "right", part = "body")
TablaAut_4VG <- colformat_num(TablaAut_4VG, big.mark = " ")
TablaAut_4VG <- bold(TablaAut_4VG, i = ~ Autoridad == "Total", bold = TRUE)
TablaAut_4VG <-autofit(TablaAut_4VG) 
TablaAut_4VG
```
<br>
Menciones a derecho en expedientes de queja en la 4VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaDer_4VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Derechos_4VG <- Derechos[Derechos$Id_adscripcion %in% 4,]

Derechos_4VG1 <- prop.table(table(Derechos_4VG[, c("Derecho")]),margin = NULL)
Derechos_4VG1  <- data.frame(Derechos_4VG1)
Derechos_4VG1$Freq <- round(Derechos_4VG1$Freq*100,1)
Derechos_4VG.1 <- table(Derechos_4VG[, c("Derecho")])
Derechos_4VG.1  <- data.frame(Derechos_4VG.1)
Derechos_4VGG <- merge(Derechos_4VG.1,Derechos_4VG1, by="Var1", all.x=TRUE)

Derechos_4VGG <- Derechos_4VGG[Derechos_4VG.1$Freq != 0, ] 
Derechos_4VGG <- Derechos_4VGG[order(Derechos_4VGG$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Derechos_4VGtop <- top_n(Derechos_4VGG,5)

#Agrupo el resto de autoridades

Derechos_4VGtop <- rbind(Derechos_4VGtop, data.frame(Var1 = "Otros",Freq.x = (sum(Derechos_4VGG[,2]) - sum(Derechos_4VGtop[,2])),Freq.y = (sum(Derechos_4VGG[,3]) - sum(Derechos_4VGtop[,3]))))

Derechos_4VGtop <- rbind(Derechos_4VGtop, data.frame(Var1 = "Total",Freq.x = sum(Derechos_4VGtop[,2]), Freq.y = round(sum(Derechos_4VGtop[,3]),0)))

colnames(Derechos_4VGtop) <- c("Derecho","Total","%")

Derechos_4VGtop[is.na(Derechos_4VGtop)] <- 0

TablaDer_4VG <-flextable(
         Derechos_4VGtop,
         col_keys = names(Derechos_4VGtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaDer_4VG <- font(TablaDer_4VG,fontname='Arial')
TablaDer_4VG <- fontsize(TablaDer_4VG, size = 10, part = "header")
TablaDer_4VG <- fontsize(TablaDer_4VG, size = 9, part = "body")
TablaDer_4VG <- bold(TablaDer_4VG, bold = TRUE, part = "header")

TablaDer_4VG <- theme_zebra(TablaDer_4VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaDer_4VG <- color(TablaDer_4VG, i = 1, color = "purple4", part = "header")
TablaDer_4VG <- hline(TablaDer_4VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaDer_4VG <- hline(TablaDer_4VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaDer_4VG <- align(TablaDer_4VG, align = "center", part = "header")
TablaDer_4VG <- align(TablaDer_4VG,j = 1 ,align = "left", part = "body")
TablaDer_4VG <- align(TablaDer_4VG,j = c(2,3) ,align = "right", part = "body")
TablaDer_4VG <- colformat_num(TablaDer_4VG, big.mark = " ")
TablaDer_4VG <- bold(TablaDer_4VG, i = ~ Derecho == "Total", bold = TRUE)
TablaDer_4VG <-autofit(TablaDer_4VG) 
TablaDer_4VG
```
**MEDIDAS PRECAUTORIAS**

**Cuarta Visitaduría**

Durante el año 2021, la 4VG tramitó `r paste0(formatC(Tab8[4,3], big.mark = " "))` solicitudes de medidas precautorias. Las principales autoridades que encabezan la lista de recepción de dichas solicitudes durante el periodo señalado son la `r paste0(Tab8.4[1,2])`, `r paste0(Tab8.4[2,2])`, y la `r paste0(Tab8.4[3,2])`.

\pagebreak

**QUINTA VISITADURÍA**

Expedientes de queja en la 5VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaExp_5VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Expedientes5VG <- Expedientes[Expedientes$Id_adscripcion %in% 5,]

Expedientes5VG <- table(Expedientes5VG[, c("Calificacion")])
Expedientes5VG <-   addmargins(Expedientes5VG, margin=1)
Expedientes5VG  <- data.frame(Expedientes5VG)
Expedientes5VG <- Expedientes5VG[Expedientes5VG$Freq != 0, ] 
colnames(Expedientes5VG) <- c("Etapa","Total")
Expedientes5VG$Etapa <- gsub("Sum", "Total", Expedientes5VG$Etapa)
Expedientes5VG[is.na(Expedientes5VG)] <- 0

TablaExp5VG <-flextable(
         Expedientes5VG,
         col_keys = names(Expedientes5VG),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaExp5VG <- font(TablaExp5VG,fontname='Arial')
TablaExp5VG <- fontsize(TablaExp5VG, size = 10, part = "header")
TablaExp5VG <- fontsize(TablaExp5VG, size = 9, part = "body")
TablaExp5VG <- bold(TablaExp5VG, bold = TRUE, part = "header")

TablaExp5VG <- merge_v(TablaExp5VG, j = c("Etapa") )
TablaExp5VG <- theme_zebra(TablaExp5VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaExp5VG <- color(TablaExp5VG, i = 1, color = "purple4", part = "header")
TablaExp5VG <- hline(TablaExp5VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaExp5VG <- hline(TablaExp5VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaExp5VG <- align(TablaExp5VG, align = "center", part = "header")
TablaExp5VG <- align(TablaExp5VG,j = 1 ,align = "left", part = "body")
TablaExp5VG <- align(TablaExp5VG,j = 2 ,align = "right", part = "body")
TablaExp5VG <- colformat_num(TablaExp5VG, big.mark = " ")
TablaExp5VG <- bold(TablaExp5VG, i = ~ Etapa == "Total", bold = TRUE)
TablaExp5VG <-autofit(TablaExp5VG)
TablaExp5VG
```
<br>
Autoridades señaladas en expedientes de queja en la 5VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaAut_5VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
#Autoridades en gestion 5VG
Autoridad_gestion_5VG <- Autoridad_gestion[Autoridad_gestion$Id_adscripcion %in% 5,]

Autoridad_gestion_5VG1 <- prop.table(table(Autoridad_gestion_5VG[, c("Organismo_Generico")]),margin = NULL)
Autoridad_gestion_5VG1  <- data.frame(Autoridad_gestion_5VG1)
Autoridad_gestion_5VG1$Freq <- round(Autoridad_gestion_5VG1$Freq*100,1)
Autoridad_gestion_5VG.1 <- table(Autoridad_gestion_5VG[, c("Organismo_Generico")])
Autoridad_gestion_5VG.1  <- data.frame(Autoridad_gestion_5VG.1)
Autoridad_gestion_5VGG <- merge(Autoridad_gestion_5VG.1,Autoridad_gestion_5VG1, by="Var1", all.x=TRUE)

Autoridad_gestion_5VGG <- Autoridad_gestion_5VGG[Autoridad_gestion_5VG.1$Freq != 0, ] 
Autoridad_gestion_5VGG <- Autoridad_gestion_5VGG[order(Autoridad_gestion_5VGG$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Autoridad_gestion_5VGtop <- top_n(Autoridad_gestion_5VGG,5)

#Agrupo el resto de autoridades

Autoridad_gestion_5VGtop <- rbind(Autoridad_gestion_5VGtop, data.frame(Var1 = "Otros",Freq.x = (sum(Autoridad_gestion_5VGG[,2]) - sum(Autoridad_gestion_5VGtop[,2])),Freq.y = (sum(Autoridad_gestion_5VGG[,3]) - sum(Autoridad_gestion_5VGtop[,3]))))

Autoridad_gestion_5VGtop <- rbind(Autoridad_gestion_5VGtop, data.frame(Var1 = "Total",Freq.x = sum(Autoridad_gestion_5VGtop[,2]), Freq.y = round(sum(Autoridad_gestion_5VGtop[,3]),0)))

colnames(Autoridad_gestion_5VGtop) <- c("Autoridad","Total","%")

Autoridad_gestion_5VGtop[is.na(Autoridad_gestion_5VGtop)] <- 0

TablaAut_5VG <-flextable(
         Autoridad_gestion_5VGtop,
         col_keys = names(Autoridad_gestion_5VGtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaAut_5VG <- font(TablaAut_5VG,fontname='Arial')
TablaAut_5VG <- fontsize(TablaAut_5VG, size = 10, part = "header")
TablaAut_5VG <- fontsize(TablaAut_5VG, size = 9, part = "body")
TablaAut_5VG <- bold(TablaAut_5VG, bold = TRUE, part = "header")

TablaAut_5VG <- theme_zebra(TablaAut_5VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaAut_5VG <- color(TablaAut_5VG, i = 1, color = "purple4", part = "header")
TablaAut_5VG <- hline(TablaAut_5VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaAut_5VG <- hline(TablaAut_5VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaAut_5VG <- align(TablaAut_5VG, align = "center", part = "header")
TablaAut_5VG <- align(TablaAut_5VG,j = 1 ,align = "left", part = "body")
TablaAut_5VG <- align(TablaAut_5VG,j = c(2,3) ,align = "right", part = "body")
TablaAut_5VG <- colformat_num(TablaAut_5VG, big.mark = " ")
TablaAut_5VG <- bold(TablaAut_5VG, i = ~ Autoridad == "Total", bold = TRUE)
TablaAut_5VG <-autofit(TablaAut_5VG) 
TablaAut_5VG
```
<br>
Menciones a derecho en expedientes de queja en la 5VG (Siigesi), `r paste0(format(Sys.Date(),"%Y"))`
```{r TablaDer_5VG, echo=FALSE, results='asis', message=FALSE, include=TRUE, error=FALSE, warning=FALSE}
Derechos_5VG <- Derechos[Derechos$Id_adscripcion %in% 5,]

Derechos_5VG1 <- prop.table(table(Derechos_5VG[, c("Derecho")]),margin = NULL)
Derechos_5VG1  <- data.frame(Derechos_5VG1)
Derechos_5VG1$Freq <- round(Derechos_5VG1$Freq*100,1)
Derechos_5VG.1 <- table(Derechos_5VG[, c("Derecho")])
Derechos_5VG.1  <- data.frame(Derechos_5VG.1)
Derechos_5VGG <- merge(Derechos_5VG.1,Derechos_5VG1, by="Var1", all.x=TRUE)

Derechos_5VGG <- Derechos_5VGG[Derechos_5VG.1$Freq != 0, ] 
Derechos_5VGG <- Derechos_5VGG[order(Derechos_5VGG$Freq.x,decreasing = TRUE),]
#Obtengo las 5 autoridades más frecuentes
Derechos_5VGtop <- top_n(Derechos_5VGG,5)

#Agrupo el resto de autoridades

Derechos_5VGtop <- rbind(Derechos_5VGtop, data.frame(Var1 = "Otros",Freq.x = (sum(Derechos_5VGG[,2]) - sum(Derechos_5VGtop[,2])),Freq.y = (sum(Derechos_5VGG[,3]) - sum(Derechos_5VGtop[,3]))))

Derechos_5VGtop <- rbind(Derechos_5VGtop, data.frame(Var1 = "Total",Freq.x = sum(Derechos_5VGtop[,2]), Freq.y = round(sum(Derechos_5VGtop[,3]),0)))

colnames(Derechos_5VGtop) <- c("Derecho","Total","%")

Derechos_5VGtop[is.na(Derechos_5VGtop)] <- 0

TablaDer_5VG <-flextable(
         Derechos_5VGtop,
         col_keys = names(Derechos_5VGtop),
         cwidth = 0.75,
         cheight = 0.25,
         defaults = list(),
         set_flextable_defaults( 
         font.size = 8, 
         theme_fun = theme_vanilla,
         padding.bottom = 2, 
         padding.top = 2,
         padding.left = 2,
         padding.right = 2,
         background.color = "white"))

TablaDer_5VG <- font(TablaDer_5VG,fontname='Arial')
TablaDer_5VG <- fontsize(TablaDer_5VG, size = 10, part = "header")
TablaDer_5VG <- fontsize(TablaDer_5VG, size = 9, part = "body")
TablaDer_5VG <- bold(TablaDer_5VG, bold = TRUE, part = "header")

TablaDer_5VG <- theme_zebra(TablaDer_5VG, odd_header = "mediumpurple1", even_header = "#A52A2A")
TablaDer_5VG <- color(TablaDer_5VG, i = 1, color = "purple4", part = "header")
TablaDer_5VG <- hline(TablaDer_5VG, border = fp_border(width = .75, color = "purple4"), part = "body" )
TablaDer_5VG <- hline(TablaDer_5VG, border = fp_border(width = 1, color = "purple4"), part = "header" )
TablaDer_5VG <- align(TablaDer_5VG, align = "center", part = "header")
TablaDer_5VG <- align(TablaDer_5VG,j = 1 ,align = "left", part = "body")
TablaDer_5VG <- align(TablaDer_5VG,j = c(2,3) ,align = "right", part = "body")
TablaDer_5VG <- colformat_num(TablaDer_5VG, big.mark = " ")
TablaDer_5VG <- bold(TablaDer_5VG, i = ~ Derecho == "Total", bold = TRUE)
TablaDer_5VG <-autofit(TablaDer_5VG) 
TablaDer_5VG
```
**MEDIDAS PRECAUTORIAS**

**Quinta Visitaduría**

Durante el año 2021, la 5VG tramitó `r paste0(formatC(Tab8[5,3], big.mark = " "))` solicitudes de medidas precautorias. Las principales autoridades que encabezan la lista de recepción de dichas solicitudes durante el periodo señalado son la `r paste0(Tab8.5[1,2])`, `r paste0(Tab8.5[2,2])`, y la `r paste0(Tab8.5[3,2])`.


